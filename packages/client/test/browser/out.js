(()=>{var Wi=Object.create;var xt=Object.defineProperty;var Vi=Object.getOwnPropertyDescriptor;var Yi=Object.getOwnPropertyNames;var Xi=Object.getPrototypeOf,eo=Object.prototype.hasOwnProperty;var to=(e,t)=>()=>(e&&(t=e(e=0)),t);var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ro=(e,t)=>{for(var r in t)xt(e,r,{get:t[r],enumerable:!0})},En=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Yi(t))!eo.call(e,s)&&s!==r&&xt(e,s,{get:()=>t[s],enumerable:!(n=Vi(t,s))||n.enumerable});return e};var no=(e,t,r)=>(r=e!=null?Wi(Xi(e)):{},En(t||!e||!e.__esModule?xt(r,"default",{value:e,enumerable:!0}):r,e)),so=e=>En(xt({},"__esModule",{value:!0}),e);var Un=b(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.default=(e,t)=>{typeof e=="function"?e().then(r=>{t(r)}):t(e)}});var Fn=b(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});var xn=e=>{let t=Array.isArray(e)?[]:{};for(let r in e)e[r]!==null&&typeof e[r]=="object"?t[r]=xn(e[r]):t[r]=e[r];return t};Mr.default=xn});var Ln=b(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});function io(e){return e&&typeof e=="object"&&e.constructor!==Array}Pr.default=io});var Rn=b(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.default=(e=100)=>new Promise(t=>{setTimeout(()=>t(),e)})});var $n=b(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});var Ar=(e,t)=>{let r=typeof e,n=typeof t;if(e===t)return!0;if(r!==n||e===null||t===null)return!1;if(r!=="object"){if(r==="function"){if(e.toString()!==t.toString())return!1}else if(e!==t)return!1}else{if(Array.isArray(e))if(Array.isArray(t)){let i=e.length;if(i!==t.length)return!1;for(let o=0;o<i;o++){let a=typeof e[o];if(typeof t[o]!==a)return!1;if(a==="object"&&!Ar(e[o],t[o]))return!1}}else return!1;if(e.checksum||t.checksum)return e.checksum===t.checksum;let s=0;for(let i in e){if(i[0]==="_"||!e.hasOwnProperty(i))continue;if(!t.hasOwnProperty(i))return!1;let o=t[i],a=e[i];if(o===void 0&&a!==void 0)return!1;let f=typeof o;if(f!==typeof a)return!1;if(o&&f==="object"){if(!Ar(a,o))return!1}else if(o!==a)return!1;s++}for(let i in t)if(s--,s<0)return!1}return!0};Dr.default=Ar});var Nn=b(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.default=e=>(e=e.replace(/[@-\\/|*&^%$#@!()\-+]/g,"_"),e=e.replace(/^_+/,""),e=e.replace(/_+$/,""),e.toUpperCase())});var Gn=b(()=>{});var Jn=b(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});var oo=Gn();zr.default=e=>new Promise((t,r)=>{let n=new oo.PassThrough;n.on("error",i=>{r(i)});let s=[];n.on("data",i=>{typeof i=="string"?s.push(Buffer.from(i)):s.push(i)}),n.on("end",i=>{t(Buffer.concat(s))}),e.pipe(n)})});var Ue=b(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});var ao=(e,t=5381)=>{let r=e.length;for(;r;){let n=e.charCodeAt(--r);t=t*33^n}return t};Ir.default=ao});var Qr=b(dt=>{"use strict";var uo=dt&&dt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dt,"__esModule",{value:!0});var G=uo(Ue()),Cr=(e,t=5381,r=52711)=>{if(Array.isArray(e))for(let n=0;n<e.length;n++){let s=e[n],i=typeof s;if(i==="string"){let o=n+":"+s;t=G.default(o,t),r=G.default(o,r)}else if(i==="number"){let o=n+"n:"+s;t=G.default(o,t),r=G.default(o,r)}else if(i==="object")if(s===null){let o=n+"v:null";t=G.default(o,t),r=G.default(o,r)}else{let o=Cr(s,t,r);t=G.default(n+"o:",o[0]),r=G.default(n+"o:",o[1])}else if(i==="boolean"){let o=n+"b:"+(s?"true":"false");t=G.default(o,t),r=G.default(o,r)}}else for(let n in e){let s=e[n],i=typeof s;if(i==="string"){let o=n+":"+s;t=G.default(o,t),r=G.default(o,r)}else if(i==="number"){let o=n+"n:"+s;t=G.default(o,t),r=G.default(o,r)}else if(i==="object")if(s===null){let o=n+"v:null";t=G.default(o,t),r=G.default(o,r)}else{let o=Cr(s,t,r);t=G.default(n+"o:",o[0]),r=G.default(n+"o:",o[1])}else if(i==="boolean"){let o=n+"b:"+(s?"true":"false");t=G.default(o,t),r=G.default(o,r)}}return[t,r]};dt.default=Cr});var Ft=b(gt=>{"use strict";var fo=gt&&gt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(gt,"__esModule",{value:!0});var lo=fo(Qr()),co=e=>{let t=lo.default(e);return(t[0]>>>0)*4096+t[1]};gt.default=co});var Br=b(pt=>{"use strict";var Kn=pt&&pt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(pt,"__esModule",{value:!0});var ho=Kn(Ft()),vt=Kn(Ue()),go=(e,t)=>{let r;if(typeof e=="object"?e===null?r=0:r=ho.default(e):typeof e=="boolean"?r=(vt.default(e?":true":":false")>>>0)*4096:typeof e=="number"?r=(vt.default("n:"+e)>>>0)*4096+(vt.default("n:"+e,52711)>>>0):r=(vt.default(e)>>>0)*4096+(vt.default(e,52711)>>>0),t){let n=Math.ceil(Math.log10(r+1));if(n<t)return r*Math.pow(10,t-n)}return r};pt.default=go});var Wn=b(yt=>{"use strict";var Ur=yt&&yt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yt,"__esModule",{value:!0});var Zn=Ur(Br()),Er=Ur(Ue()),vo=Ur(Ft()),Hn=Ce(),po="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",kn=e=>{let t="",r;do r=e%62,t=po.charAt(r)+t,e=Math.floor(e/62);while(e>0);return t},yo=(e,t,r)=>{let n;if(typeof e=="object")if(e===null)n=0;else if(t&&t>9&&e.constructor===Array){let o="",a=e.length;for(let u=0;u<a;u++)o+=kn(r&&e[u]&&typeof e[u]=="object"?Hn.hashObjectIgnoreKeyOrder(e[u]):Zn.default(e[u]));let f=o.length;if(f<t)o+="x",f+1<t&&(o+=new Array(t-f).join("0"));else if(f>t)return o.slice(0,t);return o}else n=(r?Hn.hashObjectIgnoreKeyOrder(e):vo.default(e))>>>0;else typeof e=="boolean"?n=Er.default(e?":true":":false")*4096:typeof e=="number"?n=(Er.default("n:"+e)>>>0)*4096:n=Er.default(e)>>>0;let s=kn(n),i=s.length;return i<t&&(s+="x",i+1<t&&(s+=new Array(t-i).join("0"))),s};yt.default=yo});var Fr=b(bt=>{"use strict";var bo=bt&&bt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(bt,"__esModule",{value:!0});var L=bo(Ue()),xr=(e,t=5381,r=52711)=>{if(Array.isArray(e)){let n="__len:"+e.length+1;t=L.default(n,t),r=L.default(n,r);for(let s=0;s<e.length;s++){let i=e[s],o=typeof i;if(o==="string"){let a=s+":"+i;t=L.default(a,t),r=L.default(a,r)}else if(o==="number"){let a=s+"n:"+i;t=L.default(a,t),r=L.default(a,r)}else if(o==="object")if(i===null){let a=s+"v:null";t=L.default(a,t),r=L.default(a,r)}else{let a=xr(i,t,r),f=s+"o:";t=L.default(f,a[0]),r=L.default(f,a[1])}else if(o==="boolean"){let a=s+"b:"+(i?"true":"false");t=L.default(a,t),r=L.default(a,r)}}}else{let n=Object.keys(e).sort(),s="__len:"+n.length+1;t=L.default(s,t),r=L.default(s,r);for(let i=0;i<n.length;i++){let o=n[i],a=e[o],f=typeof a;if(f==="string"){let u=o+":"+a;t=L.default(u,t),r=L.default(u,r)}else if(f==="number"){let u=o+"n:"+a;t=L.default(u,t),r=L.default(u,r)}else if(f==="object")if(a===null){let u=o+"v:null";t=L.default(u,t),r=L.default(u,r)}else{let u=xr(a,t,r),l=o+"o:";t=L.default(l,u[0]),r=L.default(l,u[1])}else if(f==="boolean"){let u=o+"b:"+(a?"true":"false");t=L.default(u,t),r=L.default(u,r)}}}return[t,r]};bt.default=xr});var Vn=b(mt=>{"use strict";var mo=mt&&mt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(mt,"__esModule",{value:!0});var So=mo(Fr()),_o=e=>{let t=So.default(e);return(t[0]>>>0)*4096+(t[1]>>>0)};mt.default=_o});var Ce=b(ce=>{"use strict";var Qe=ce&&ce.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ce,"__esModule",{value:!0});var wo=Qe(Br());ce.hash=wo.default;var Oo=Qe(Wn());ce.hashCompact=Oo.default;var jo=Qe(Ft());ce.hashObject=jo.default;var Mo=Qe(Vn());ce.hashObjectIgnoreKeyOrder=Mo.default;var Po=Qe(Fr());ce.hashObjectIgnoreKeyOrderNest=Po.default;var To=Qe(Qr());ce.hashObjectNest=To.default;var Ao=Qe(Ue());ce.stringHash=Ao.default});var Xn=b((el,Yn)=>{"use strict";Yn.exports=e=>{if(Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}});var es=b(St=>{"use strict";var Do=St&&St.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(St,"__esModule",{value:!0});var Lr=Ce(),qo=Do(Xn());function zo(e,t){let r=0,n=(...s)=>new Promise((i,o)=>{e(...s).then(a=>i(a)).catch(a=>{var f,u;r++,t.logError&&t.logError(a,s,r),!t.max||r<t.max?setTimeout(()=>{i(n(...s))},Math.min(r*((f=t.minTime)!==null&&f!==void 0?f:1e3),(u=t.maxTime)!==null&&u!==void 0?u:1/0)):o(a)})});return n}var Io=(...e)=>{let t="";for(let r of e)r!==void 0&&(typeof r=="object"?(Array.isArray(r)||(0,qo.default)(r))&&(t+=(0,Lr.hashObjectIgnoreKeyOrder)(r)):t+=(0,Lr.hash)(r));return t||(~~(Math.random()*99999)).toString(16)};function Co(e,t={}){t.retry&&(e=zo(e,t.retry)),t.dedup||(t.dedup=Io),t.concurrency||(t.concurrency=1);let r={},n=new Set,s=()=>{for(let i in r){if(n.size===t.concurrency)break;if(!n.has(i)){let o=r[i];if(n.add(i),e(...o.args).then(a=>{delete r[i],n.delete(i),o.listeners.forEach(([f])=>{f(a)}),s()}).catch(a=>{delete r[i],n.delete(i),o.listeners.forEach(([,f])=>{f(a)}),s()}),n.size===t.concurrency)break}}};return(...i)=>new Promise((o,a)=>{let f=t.dedup(...i);r[f]?r[f].listeners.push([o,a]):r[f]={args:i,listeners:[[o,a]]},n.size<t.concurrency&&s()})}St.default=Co});var rs=b(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});function ts(e,t,...r){return new Promise((n,s)=>{let{timeout:i=100,maxRetries:o=-1}=t,a=0;e(...r).then(f=>n(f)).catch(f=>{++a<=o||o<0?setTimeout(()=>{n(ts(e,{timeout:i,maxRetries:o-1},...r))},i):s(f)})})}Rr.default=ts});var ns=b($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});function Qo(e,t){let r=t&&t.noSpecials||!1,n=t&&t.noLowerCase||!1,s=t&&t.noUpperCase||!1,i=t&&t.noNumbers||!1,o="ABCDEFGHIJKLMNOPQRSTUVWXYZ",a="abcdefghijklmnopqrstuvwxyz",f="0123456789",u="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",l="";r||(l+=u),n||(l+=a),s||(l+=o),i||(l+=f);let c="",d=l.length;for(let h=0;h<e;h++)c+=l.charAt(Math.floor(Math.random()*d));return c}$r.default=Qo});var Nr=b(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.padRight=xe.padLeft=void 0;var Bo=(e,t,r)=>{let n=e.length;for(let s=0;s<t-n;s++)e=r+e;return e};xe.padLeft=Bo;var Eo=(e,t,r)=>{let n=e.length;for(let s=0;s<t-n;s++)e=e+r;return e};xe.padRight=Eo});var ss=b(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.createDecode=void 0;var Uo=(e,t,r=["$"],n)=>{if(r.length>1&&e)return i=>{let o="";for(let a=0;a<i.length;a++){let f=i[a];if(r.includes(f)){let u="";for(let c=0;c<t;c++)u+=i[a+c+1];let l=n[u];o+=l,a+=t}else o+=f}return o};if(r.length>1)return i=>{let o="";for(let a=0;a<i.length;a++){let f=i[a];if(r.includes(f)){let u=n[i[a+1]];o+=u,a++}else o+=f}return o};let s=r[0];return e?i=>{let o="";for(let a=0;a<i.length;a++){let f=i[a];if(f===s){let u="";for(let c=0;c<t;c++)u+=i[a+c+1];let l=n[u];o+=l,a+=t}else o+=f}return o}:i=>{let o="";for(let a=0;a<i.length;a++){let f=i[a];if(f===s){let u=n[i[a+1]];o+=u,a++}else o+=f}return o}};Lt.createDecode=Uo});var os=b(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.createEncode=void 0;var is=(e,t)=>t%2?e[e.length-t]:e[t],xo=(e,t,r)=>{if(r.length>1&&e===1){let n=r.length;return s=>{let i=0,o="";for(let a=0;a<s.length;a++){let f=s.charAt(a);t[f]?(i+=1,i>=n&&(i=0),o+=is(r,i)+t[f]):o+=f}return o}}if(r.length>1){let n=r.length;return s=>{let i=0,o="";for(let a=0;a<s.length;a++){let f=!1;for(let u=e-1;u>-1;u--){if(a+u>s.length-1)continue;let l="";for(let c=0;c<u+1;c++)l+=s.charAt(a+c);t[l]&&(i+=1,i>=n&&(i=0),o+=is(r,i)+t[l],a+=l.length-1,u=-1,f=!0)}f||(o+=s.charAt(a))}return o}}return e===1?n=>{let s="";for(let i=0;i<n.length;i++){let o=n.charAt(i);t[o]?s+=t[o]:s+=o}return s}:n=>{let s="";for(let i=0;i<n.length;i++){let o=!1;for(let a=e-1;a>-1;a--){if(i+a>n.length-1)continue;let f="";for(let u=0;u<a+1;u++)f+=n.charAt(i+u);t[f]&&(s+=t[f],i+=f.length-1,a=-1,o=!0)}o||(s+=n.charAt(i))}return s}};Rt.createEncode=xo});var as=b($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.createEncoder=void 0;var Fo=ss(),Lo=os(),Ro=Nr(),$o=(e,t=["$"])=>{let r=1,n=e.length>36,s=[...e,...t],i=s.map((u,l)=>(u.length>r&&(r=u.length),l>25?String(l-26):String.fromCharCode(97+l))),o={},a={};for(let u=0;u<s.length;u++)o[s[u]]=t.length===1?t[0]+i[u]:i[u],a[i[u]]=s[u];let f=1;if(n){for(let u in a)u.length>f&&(f=u.length);for(let u in a)if(u.length<f){let l=(0,Ro.padLeft)(u,f,"0"),c=a[u];t.length>1?o[c]=l:o[c]=t[0]+l,delete a[u],a[l]=c}}return{charMap:o,reverseCharMap:a,encode:(0,Lo.createEncode)(r,o,t),decode:(0,Fo.createDecode)(n,f,t,a)}};$t.createEncoder=$o});var us=b(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.deepMerge=Fe.deepMergeArrays=void 0;var Nt=(e,t)=>{if(t.constructor===Array)for(let r=0;r<t.length;r++)r in e&&e[r]&&typeof e[r]=="object"&&t[r]&&typeof t[r]=="object"?Nt(e[r],t[r]):e[r]=t[r];else for(let r in t)r in e&&e[r]&&typeof e[r]=="object"&&t[r]&&typeof t[r]=="object"?Nt(e[r],t[r]):e[r]=t[r]};function No(e,...t){if(!t.length)return e;if(t.length===1){let r=t[0];if(e&&typeof e=="object"&&r&&typeof r=="object")return Nt(e,r),e}for(let r=0;r<t.length;r++){let n=t[r];if(e&&typeof e=="object"&&n&&typeof n=="object")return Nt(e,n),e}return e}Fe.deepMergeArrays=No;var Gr=(e,t)=>{if(t.constructor===Array||e.constructor===Array)return t;for(let r in t)if(r in e)if(e[r]&&t[r]&&typeof e[r]=="object"&&e[r].constructor!==Array&&typeof t[r]=="object"&&t[r].constructor!==Array){let n=Gr(e[r],t[r]);n!==e[r]&&(e[r]=n)}else e[r]=t[r];else e[r]=t[r];return e};function Go(e,...t){if(!t.length)return e;if(t.length===1){let r=t[0];if(e&&typeof e=="object"&&r&&typeof r=="object")return Gr(e,r)}for(let r=0;r<t.length;r++){let n=t[r];if(e&&typeof e=="object"&&n&&typeof n=="object"){let s=Gr(e,n);s!==e&&(e=s)}}return e}Fe.deepMerge=Go});var fs=b(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.walk=void 0;var Le=ve(),Jo=async e=>(0,Le.getType)(e.ref)!=="object",Ko=async(e,t)=>Object.keys(e).map(r=>({name:r,ref:e[r],path:[t,r].filter(Boolean).join("/"),type:(0,Le.getType)(e[r])})),Zo=async e=>(0,Le.getType)(e.ref)==="object",Ho=async e=>(0,Le.getType)(e)==="object",ko=async(e,t,r)=>{if(r={listFn:Ko,itemMatchFn:Jo,recurseFn:Zo,targetValidationFn:Ho,...r},(0,Le.getType)(r.targetValidationFn)==="function"&&!await r.targetValidationFn(e))return;["listFn","itemMatchFn","recurseFn"].forEach(s=>{if((0,Le.getType)(r[s])!=="function")throw new Error(s+" should be a function")});let n=await r.listFn(e,r.previousPath);await Promise.all(n.map(async s=>{let{name:i,path:o,type:a}=s;await r.itemMatchFn(s)&&await t(s.ref,{name:i,path:o,type:a}),await r.recurseFn(s)&&await(0,_t.walk)(s.ref,t,{...r,previousPath:s.path})}))};_t.walk=ko});var ls=b(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.getType=void 0;var Wo=e=>e===null?"null":Array.isArray(e)?"array":typeof e;Gt.getType=Wo});var cs=b(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.serializeQuery=Ae.parseQuery=void 0;var Jr=e=>{if(e.includes(",")){e=e.split(",");for(let t=0;t<e.length;t++)e[t]=Jr(e[t]);return e}return e==="null"?null:e==="true"||e===""?!0:e==="false"?!1:isNaN(e)?e:Number(e)},Vo=e=>{if(e)try{let t={},r="",n="",s=!1,i=0,o=e.length;for(let a=0;a<o;a++){let f=e[a];if(f==="&"&&(!i||i===1&&e[a-1]==="}"||i===2&&e[a-1]==="]")){if(!s)t[r]=!0;else if(i)try{t[r]=JSON.parse(n)}catch{t[r]=n}else t[r]=Jr(n);i=0,s=!1,r="",n=""}else f==="="&&!i?s=!0:s?(n===""&&(f==="{"?i=1:f==="["&&(i=2)),n+=f):r+=f}if(r)if(i)try{t[r]=JSON.parse(n)}catch{t[r]=n}else t[r]=Jr(n);return t}catch{}};Ae.parseQuery=Vo;var Yo=e=>{let t=[];for(let r in e){let n=e[r];n===!0?t.push(`${r}`):t.push(`${r}=${(0,Ae.serializeQuery)(n,!0)}`)}return t.join("&")},Xo=(e,t=!1)=>typeof e=="string"?e:typeof e=="boolean"?e?"true":"false":typeof e=="number"||typeof e=="number"?String(e):e===null?"null":Array.isArray(e)?e.map(r=>typeof r=="object"&&r!==null?JSON.stringify(r):(0,Ae.serializeQuery)(r,!0)).join(","):typeof e=="object"?t?JSON.stringify(e):Yo(e):"";Ae.serializeQuery=Xo});var hs=b(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.encodeBase64=Re.decodeBase64=void 0;var ea=e=>e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0,Jt=e=>e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65,ta=(e,t)=>{let r=e.replace(/[^A-Za-z0-9+/]/g,""),n=r.length,s=t?Math.ceil((n*3+1>>2)/t)*t:n*3+1>>2,i=new Uint8Array(s),o,a,f=0,u=0;for(let l=0;l<n;l++)if(a=l&3,f|=ea(r.charCodeAt(l))<<6*(3-a),a===3||n-l===1){for(o=0;o<3&&u<s;)i[u]=f>>>(16>>>o&24)&255,o++,u++;f=0}return i};Re.decodeBase64=ta;var ra=e=>{let t=2,r="",n=e.length,s=0;for(let i=0;i<n;i++)t=i%3,s|=e[i]<<(16>>>t&24),(t===2||e.length-i===1)&&(r+=String.fromCodePoint(Jt(s>>>18&63),Jt(s>>>12&63),Jt(s>>>6&63),Jt(s&63)),s=0);return r.substring(0,r.length-2+t)+(t===2?"":t===1?"=":"==")};Re.encodeBase64=ra});var ds=b($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.stringToUtf8=$e.uft8ToString=void 0;var na=e=>{let t="",r,n=e.length;for(let s=0;s<n;s++)r=e[s],t+=String.fromCodePoint(r>251&&r<254&&s+5<n?(r-252)*1073741824+(e[++s]-128<<24)+(e[++s]-128<<18)+(e[++s]-128<<12)+(e[++s]-128<<6)+e[++s]-128:r>247&&r<252&&s+4<n?(r-248<<24)+(e[++s]-128<<18)+(e[++s]-128<<12)+(e[++s]-128<<6)+e[++s]-128:r>239&&r<248&&s+3<n?(r-240<<18)+(e[++s]-128<<12)+(e[++s]-128<<6)+e[++s]-128:r>223&&r<240&&s+2<n?(r-224<<12)+(e[++s]-128<<6)+e[++s]-128:r>191&&r<224&&s+1<n?(r-192<<6)+e[++s]-128:r);return t};$e.uft8ToString=na;var sa=e=>{let t,r=e.length,n=0;for(let a=0;a<r;a++)t=e.codePointAt(a),t>=65536&&a++,n+=t<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;let s=new Uint8Array(n),i=0,o=0;for(;i<n;)t=e.codePointAt(o),t<128?s[i++]=t:t<2048?(s[i++]=192+(t>>>6),s[i++]=128+(t&63)):t<65536?(s[i++]=224+(t>>>12),s[i++]=128+(t>>>6&63),s[i++]=128+(t&63)):t<2097152?(s[i++]=240+(t>>>18),s[i++]=128+(t>>>12&63),s[i++]=128+(t>>>6&63),s[i++]=128+(t&63),o++):t<67108864?(s[i++]=248+(t>>>24),s[i++]=128+(t>>>18&63),s[i++]=128+(t>>>12&63),s[i++]=128+(t>>>6&63),s[i++]=128+(t&63),o++):(s[i++]=252+(t>>>30),s[i++]=128+(t>>>24&63),s[i++]=128+(t>>>18&63),s[i++]=128+(t>>>12&63),s[i++]=128+(t>>>6&63),s[i++]=128+(t&63),o++),o++;return s};$e.stringToUtf8=sa});var gs=b(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.getByPath=Ne.setByPath=void 0;function ia(e,t,r){if(typeof e!="object")return e;let n=e;for(let s=0;s<t.length;s++){let i=t[s];if(s===t.length-1){n[i]=r;break}n[i]===void 0&&(typeof t[s+1]=="number"?n[i]=[]:n[i]={}),n=n[i]}return e}Ne.setByPath=ia;var oa=(e,t)=>{if(typeof e!="object")return;let r=e;for(let n=0;n<t.length;n++){let s=t[n];if(r?.[s]!==void 0)r=r[s];else{r=void 0;break}}return r};Ne.getByPath=oa});var ve=b(P=>{"use strict";var aa=P&&P.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),_e=P&&P.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&aa(t,e,r)},we=P&&P.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(P,"__esModule",{value:!0});P.randomString=P.retry=P.toEnvVar=P.deepEqual=P.wait=P.isObject=P.readStream=P.queued=P.deepCopy=void 0;var ua=we(Fn());P.deepCopy=ua.default;var fa=we(Ln());P.isObject=fa.default;var la=we(Rn());P.wait=la.default;var ca=we($n());P.deepEqual=ca.default;var ha=we(Nn());P.toEnvVar=ha.default;var da=we(Jn());P.readStream=da.default;var ga=we(es());P.queued=ga.default;var va=we(rs());P.retry=va.default;var pa=we(ns());P.randomString=pa.default;_e(Nr(),P);_e(as(),P);_e(us(),P);_e(fs(),P);_e(ls(),P);_e(cs(),P);_e(hs(),P);_e(ds(),P);_e(gs(),P)});var Kr=b(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.encodeAuthState=Ge.decodeAuthState=void 0;var wt=ve(),ya=e=>{try{let t=(0,wt.uft8ToString)((0,wt.decodeBase64)(decodeURI(e)));return JSON.parse(t)}catch{return{error:"Invalid authState"}}};Ge.decodeAuthState=ya;var{encode:ba}=(0,wt.createEncoder)(["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," "],["0"]),ma=e=>{let t=ba((0,wt.encodeBase64)((0,wt.stringToUtf8)(JSON.stringify(e))));return encodeURI(t)};Ge.encodeAuthState=ma});var ps=b((yl,vs)=>{vs.exports=fetch});var Hr=b((bl,js)=>{var Sa=Object.create,Kt=Object.defineProperty,_a=Object.getOwnPropertyDescriptor,wa=Object.getOwnPropertyNames,Oa=Object.getPrototypeOf,ja=Object.prototype.hasOwnProperty,Ma=(e,t)=>{for(var r in t)Kt(e,r,{get:t[r],enumerable:!0})},bs=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of wa(t))!ja.call(e,s)&&s!==r&&Kt(e,s,{get:()=>t[s],enumerable:!(n=_a(t,s))||n.enumerable});return e},Pa=(e,t,r)=>(r=e!=null?Sa(Oa(e)):{},bs(t||!e||!e.__esModule?Kt(r,"default",{value:e,enumerable:!0}):r,e)),Ta=e=>bs(Kt({},"__esModule",{value:!0}),e),ms={};Ma(ms,{default:()=>Ea,genCache:()=>ws,getServicePort:()=>Ss});js.exports=Ta(ms);var Aa=Pa(ps()),Zr=ve(),Da=e=>{let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);let n=t>>>0;for(;n>65535;)n=n/10;return Math.round(n)},Ss=(e,t,r,n,s="allServices",i=0)=>Da(`${s}-${e}-${t}-${r}-${n}-${i}`),qa=Ce(),_s=e=>e||"@based/env-hub",za={"@based/env-hub":0,"@based/env-admin-hub":1,"@based/admin-hub":2,"@based/machine-hub":3},ws=e=>{let t=za[_s(e.name)],r=Math.floor(Math.random()*1e4),n=t+""+r;return e.key?n+"/"+(e.optionalKey?e.key+"$":e.key):n},Ia=async(e,t,r)=>{try{let n=await(0,Aa.default)(`${e}/status/${ws(t)}`,{headers:t.headers});if(n.ok){let s=n.headers.get("x-request-id");if(!s)return 1;let{decode:i}=(0,Zr.createEncoder)(Qa,s.slice(0,6).split("")),o=i(s.slice(6)).split(","),a=[];for(let l=0;l<Math.floor(o.length/2);l++)a.push([o[l],encodeURIComponent(o[o.length-1-l])]);let[f,u]=a[~~(Math.random()*a.length)];return r?`${/^https/.test(e)?"https":"http"}://${f}`:`${/^https/.test(e)?"wss":"ws"}://${f}/${u}`}else return!1}catch{return!1}},ys=/^ws/,Ca=({cluster:e="production",org:t,project:r,env:n,name:s})=>{if(e==="local")return[`http://localhost:${Ss(t,r,n,_s(s).includes("env-")?"@based/env-hub-discovery":"@based/hub-discovery","allServices")}`];let i="-status";return[`https://${(0,qa.hashObjectIgnoreKeyOrder)({org:t,project:r,env:n,cluster:e}).toString(36)}${i}.based.dev`]},Os=async(e,t=!1,r=0)=>{if(e.url){let s;return typeof e.url=="function"?s=await e.url():s=e.url,t&&s&&ys.test(s)?s.replace(ys,"http"):s}let n=e.discoveryUrls||Ca(e);for(let s=0;s<n.length;s++){let i=n[s],o=await Promise.race([Ia(i,e,t),(0,Zr.wait)(3e3)]);if(o===1||!o&&s===n.length-1)return await(0,Zr.wait)(Math.min(r*r*50+500,5e3)),Os(e,t,++r);if(o)return o}},Qa=[",",".based.dev","localhost:","localhost","based.io","based.dev","@based","/env-hub","admin","hub","900","90","443","80",":","%","/","=","<","?","."],Ba=Os,Ea=async(e,t)=>Ba(e,t)});var Zt=b(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.convertDataToBasedError=Oe.BasedError=Oe.BasedErrorCode=void 0;var kr;kr=Oe.BasedErrorCode||(Oe.BasedErrorCode={});var Ot=class extends Error{};Oe.BasedError=Ot;var Ua=(e,t)=>{if(!e||typeof e!="object"){let o=new Ot(`Payload: ${e}`);return o.name="Invalid returned payload",o}let{message:r,code:n}=e,s=r?r[0]==="["?r:`[${kr[n]}] `+r:n?"Cannot read error msg":JSON.stringify(e,null,2),i=new Ot(s);return i.stack=t?s+" "+t:s,i.name=kr[n],i.code=n,i};Oe.convertDataToBasedError=Ua});var Ps=b(je=>{"use strict";var xa=je&&je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(je,"__esModule",{value:!0});je.isStreaming=void 0;var Fa=Vr(),La=xa(Hr()),Ms=Zt(),Wr={};je.isStreaming={streaming:!1};var jt={},Ht=(e,t)=>{t.forEach(r=>{r.reject(e)})},Ra=(e,t,r)=>{Wr[t]||(Wr[t]=!0,je.isStreaming.streaming=!0,setTimeout(async()=>{Wr[t]=!1;let n=await(0,La.default)(e.opts,!0),s=jt[t];jt[t]=[];let i=new global.FormData;for(let o=0;o<s.length;o++){let a=s[o].options,{contents:f,payload:u}=a,l=u||{};i.append(`size=${f.size},${JSON.stringify(l)}`,f)}try{let o=new global.XMLHttpRequest;o.upload.onprogress=a=>{let f=(a.loaded||a.position)/(a.totalSize||a.total);s.forEach(u=>{u.progressListener&&u.progressListener(f,s.length)})},o.onerror=a=>{if(console.error("Based xhr error",a),o.status===0&&!o.statusText){let f=(0,Ms.convertDataToBasedError)({message:`[${t}] XHR Error`,code:0});Ht(f,s)}else console.error(a)},o.timeout=1e3*60*60*24,o.onabort=()=>{let a=new Error("File upload aborted before it finished");Ht(a,s)},o.ontimeout=()=>{console.error("on timeout")},o.onload=()=>{try{let a=JSON.parse(o.response);for(let f=0;f<a.length;f++){let u=a[f];u.error?s[f].reject((0,Ms.convertDataToBasedError)(u.error)):s[f].resolve(a[f].value)}}catch(a){Ht(a,s)}je.isStreaming.streaming=!1},o.open("POST",n+"/"+t,!0),o.setRequestHeader("Content-Type","multipart/form-data"),o.setRequestHeader("Authorization",r),o.send(i)}catch(o){console.warn("Something unexpected happened with file upload",o),Ht(o,s)}},500))};je.default=async(e,t,r,n)=>(e.connected||await e.once("connect"),jt[t]||(jt[t]=[]),new Promise((s,i)=>{jt[t].push({options:r,resolve:s,reject:i,progressListener:n}),Ra(e,t,(0,Fa.encodeAuthState)(e.authState))}))});var Ts={};ro(Ts,{default:()=>$a});var Je,$a,As=to(()=>{Je=null;typeof WebSocket<"u"?Je=WebSocket:typeof MozWebSocket<"u"?Je=MozWebSocket:typeof global<"u"?Je=global.WebSocket||global.MozWebSocket:typeof window<"u"?Je=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Je=self.WebSocket||self.MozWebSocket);$a=Je});var qs=b(Mt=>{"use strict";var Ds=Mt&&Mt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Mt,"__esModule",{value:!0});var Na=Ds(Un()),Ga=Kr(),Ja=Ps(),Ka=Ds((As(),so(Ts))),Ke=new Map,kt;typeof document<"u"&&document.addEventListener("visibilitychange",function(){clearTimeout(kt),document.hidden?kt=setTimeout(()=>{Ke.forEach(e=>{e(!1)})},3e4):Ke.forEach(e=>{e(!0)})});var Yr=(e,t,r={destroy:()=>{Ke.delete(r)}},n=0,s=!1)=>((0,Na.default)(t,i=>{setTimeout(()=>{if(r.disconnected)return;let o=!0;Ke.set(r,u=>{r.disconnected||(!u&&o?e.functionResponseListeners.size||Ja.isStreaming.streaming?(console.warn("Send to background - streams or functions in progress try again in 10 seconds..."),clearTimeout(kt),kt=setTimeout(()=>{Ke.forEach(l=>{l(!1)})},1e4)):(console.warn("Send to background - close connection"),o=!1,e.onClose(),a.close()):!o&&u&&(Ke.delete(r),Yr(e,t,r,0,!0)))});let a=r.ws=new Ka.default(i,[(0,Ga.encodeAuthState)(e.authState)]),f=!1;a.binaryType="blob",a.addEventListener("error",u=>{u.message&&u.message.includes("401")&&(f=!0)}),a.addEventListener("message",u=>{e.onData(u)}),a.addEventListener("open",()=>{if(o){if(r.disconnected)return;n=100,s&&e.onReconnect(),e.onOpen()}}),a.addEventListener("close",()=>{if(o){if(r.disconnected)return;e.onClose(),Yr(e,t,r,f?5e3:Math.min(2500,n+~~(Math.random()*500)+100),!0)}})},n)}),r);Mt.default=Yr});var zs=b(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});var Xr=class{constructor(){this.listeners={},Object.defineProperty(this,"listeners",{enumerable:!1,writable:!0})}emit(t,r){if(this.listeners[t]){let n=this.listeners[t];for(let s=0,i=n.length;s<n.length;s++){let o=n[s];o(r),i>n.length&&n[s]!==o&&(s--,i=n.length)}}}on(t,r){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(r)}removeAllListeners(){this.listeners={}}once(t,r){if(!r)return new Promise(s=>{let i=o=>{s(o),this.off(t,i)};this.on(t,i)});let n=s=>{r(s),this.off(t,n)};this.on(t,n)}off(t,r){let n=this.listeners[t];if(n)if(!r)delete this.listeners[t];else{for(let s=0;s<n.length;s++)if(n[s]===r){n.splice(s,1),s--;break}n.length===0&&delete this.listeners[t]}}};en.default=Xr});var Qs=b(Cs=>{"use strict";var Is={};Cs.default=function(e,t,r,n,s){var i=new Worker(Is[t]||(Is[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return i.onmessage=function(o){var a=o.data,f=a.$e$;if(f){var u=new Error(f[0]);u.code=f[1],u.stack=f[2],s(u,null)}else s(null,a)},i.postMessage(r,n),i}});var lr=b(w=>{"use strict";var Za=Qs(),M=Uint8Array,k=Uint16Array,Ve=Uint32Array,Ye=new M([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xe=new M([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Pt=new M([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Us=function(e,t){for(var r=new k(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var s=new Ve(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return[r,s]},xs=Us(Ye,2),fn=xs[0],er=xs[1];fn[28]=258,er[258]=28;var Fs=Us(Xe,0),Ls=Fs[0],rn=Fs[1],Tt=new k(32768);for(z=0;z<32768;++z)Me=(z&43690)>>>1|(z&21845)<<1,Me=(Me&52428)>>>2|(Me&13107)<<2,Me=(Me&61680)>>>4|(Me&3855)<<4,Tt[z]=((Me&65280)>>>8|(Me&255)<<8)>>>1;var Me,z,oe=function(e,t,r){for(var n=e.length,s=0,i=new k(t);s<n;++s)e[s]&&++i[e[s]-1];var o=new k(t);for(s=0;s<t;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(r){a=new k(1<<t);var f=15-t;for(s=0;s<n;++s)if(e[s])for(var u=s<<4|e[s],l=t-e[s],c=o[e[s]-1]++<<l,d=c|(1<<l)-1;c<=d;++c)a[Tt[c]>>>f]=u}else for(a=new k(n),s=0;s<n;++s)e[s]&&(a[s]=Tt[o[e[s]-1]++]>>>15-e[s]);return a},Te=new M(288);for(z=0;z<144;++z)Te[z]=8;var z;for(z=144;z<256;++z)Te[z]=9;var z;for(z=256;z<280;++z)Te[z]=7;var z;for(z=280;z<288;++z)Te[z]=8;var z,ke=new M(32);for(z=0;z<32;++z)ke[z]=5;var z,Rs=oe(Te,9,0),$s=oe(Te,9,1),Ns=oe(ke,5,0),Gs=oe(ke,5,1),Vt=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},ie=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},Yt=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},Dt=function(e){return(e+7)/8|0},ae=function(e,t,r){(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length);var n=new(e.BYTES_PER_ELEMENT==2?k:e.BYTES_PER_ELEMENT==4?Ve:M)(r-t);return n.set(e.subarray(t,r)),n};w.FlateErrorCode={UnexpectedEOF:0,InvalidBlockType:1,InvalidLengthLiteral:2,InvalidDistance:3,StreamFinished:4,NoStreamHandler:5,InvalidHeader:6,NoCallback:7,InvalidUTF8:8,ExtraFieldTooLong:9,InvalidDate:10,FilenameTooLong:11,StreamFinishing:12,InvalidZipData:13,UnknownCompressionMethod:14};var Js=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(e,t,r){var n=new Error(t||Js[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,S),!r)throw n;return n},qt=function(e,t,r){var n=e.length;if(!n||r&&r.f&&!r.l)return t||new M(0);var s=!t||r,i=!r||r.i;r||(r={}),t||(t=new M(n*3));var o=function(Ut){var ht=t.length;if(Ut>ht){var Ee=new M(Math.max(ht*2,Ut));Ee.set(t),t=Ee}},a=r.f||0,f=r.p||0,u=r.b||0,l=r.l,c=r.d,d=r.m,h=r.n,g=n*8;do{if(!l){a=ie(e,f,1);var v=ie(e,f+1,3);if(f+=3,v)if(v==1)l=$s,c=Gs,d=9,h=5;else if(v==2){var j=ie(e,f,31)+257,_=ie(e,f+10,15)+4,I=j+ie(e,f+5,31)+1;f+=14;for(var q=new M(I),A=new M(19),y=0;y<_;++y)A[Pt[y]]=ie(e,f+y*3,7);f+=_*3;for(var U=Vt(A),D=(1<<U)-1,K=oe(A,U,1),y=0;y<I;){var B=K[ie(e,f,D)];f+=B&15;var p=B>>>4;if(p<16)q[y++]=p;else{var x=0,C=0;for(p==16?(C=3+ie(e,f,3),f+=2,x=q[y-1]):p==17?(C=3+ie(e,f,7),f+=3):p==18&&(C=11+ie(e,f,127),f+=7);C--;)q[y++]=x}}var R=q.subarray(0,j),E=q.subarray(j);d=Vt(R),h=Vt(E),l=oe(R,d,1),c=oe(E,h,1)}else S(1);else{var p=Dt(f)+4,m=e[p-4]|e[p-3]<<8,O=p+m;if(O>n){i&&S(0);break}s&&o(u+m),t.set(e.subarray(p,O),u),r.b=u+=m,r.p=f=O*8,r.f=a;continue}if(f>g){i&&S(0);break}}s&&o(u+131072);for(var F=(1<<d)-1,V=(1<<h)-1,te=f;;te=f){var x=l[Yt(e,f)&F],se=x>>>4;if(f+=x&15,f>g){i&&S(0);break}if(x||S(2),se<256)t[u++]=se;else if(se==256){te=f,l=null;break}else{var Y=se-254;if(se>264){var y=se-257,le=Ye[y];Y=ie(e,f,(1<<le)-1)+fn[y],f+=le}var ge=c[Yt(e,f)&V],re=ge>>>4;ge||S(3),f+=ge&15;var E=Ls[re];if(re>3){var le=Xe[re];E+=Yt(e,f)&(1<<le)-1,f+=le}if(f>g){i&&S(0);break}s&&o(u+131072);for(var H=u+Y;u<H;u+=4)t[u]=t[u-E],t[u+1]=t[u+1-E],t[u+2]=t[u+2-E],t[u+3]=t[u+3-E];u=H}}r.l=l,r.p=te,r.b=u,r.f=a,l&&(a=1,r.m=d,r.d=c,r.n=h)}while(!a);return u==t.length?t:ae(t,0,u)},pe=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},Ze=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},Xt=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var s=r.length,i=r.slice();if(!s)return[Pe,0];if(s==1){var o=new M(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(I,q){return I.f-q.f}),r.push({s:-1,f:25001});var a=r[0],f=r[1],u=0,l=1,c=2;for(r[0]={s:-1,f:a.f+f.f,l:a,r:f};l!=s-1;)a=r[r[u].f<r[c].f?u++:c++],f=r[u!=l&&r[u].f<r[c].f?u++:c++],r[l++]={s:-1,f:a.f+f.f,l:a,r:f};for(var d=i[0].s,n=1;n<s;++n)i[n].s>d&&(d=i[n].s);var h=new k(d+1),g=tr(r[l-1],h,0);if(g>t){var n=0,v=0,p=g-t,m=1<<p;for(i.sort(function(q,A){return h[A.s]-h[q.s]||q.f-A.f});n<s;++n){var O=i[n].s;if(h[O]>t)v+=m-(1<<g-h[O]),h[O]=t;else break}for(v>>>=p;v>0;){var j=i[n].s;h[j]<t?v-=1<<t-h[j]++-1:++n}for(;n>=0&&v;--n){var _=i[n].s;h[_]==t&&(--h[_],++v)}g=t}return[new M(h),g]},tr=function(e,t,r){return e.s==-1?Math.max(tr(e.l,t,r+1),tr(e.r,t,r+1)):t[e.s]=r},nn=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new k(++t),n=0,s=e[0],i=1,o=function(f){r[n++]=f},a=1;a<=t;++a)if(e[a]==s&&a!=t)++i;else{if(!s&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(s),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(s);i=1,s=e[a]}return[r.subarray(0,n),t]},He=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},rr=function(e,t,r){var n=r.length,s=Dt(t+2);e[s]=n&255,e[s+1]=n>>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var i=0;i<n;++i)e[s+i+4]=r[i];return(s+4+n)*8},sn=function(e,t,r,n,s,i,o,a,f,u,l){pe(t,l++,r),++s[256];for(var c=Xt(s,15),d=c[0],h=c[1],g=Xt(i,15),v=g[0],p=g[1],m=nn(d),O=m[0],j=m[1],_=nn(v),I=_[0],q=_[1],A=new k(19),y=0;y<O.length;++y)A[O[y]&31]++;for(var y=0;y<I.length;++y)A[I[y]&31]++;for(var U=Xt(A,7),D=U[0],K=U[1],B=19;B>4&&!D[Pt[B-1]];--B);var x=u+5<<3,C=He(s,Te)+He(i,ke)+o,R=He(s,d)+He(i,v)+o+14+3*B+He(A,D)+(2*A[16]+3*A[17]+7*A[18]);if(x<=C&&x<=R)return rr(t,l,e.subarray(f,f+u));var E,F,V,te;if(pe(t,l,1+(R<C)),l+=2,R<C){E=oe(d,h,0),F=d,V=oe(v,p,0),te=v;var se=oe(D,K,0);pe(t,l,j-257),pe(t,l+5,q-1),pe(t,l+10,B-4),l+=14;for(var y=0;y<B;++y)pe(t,l+3*y,D[Pt[y]]);l+=3*B;for(var Y=[O,I],le=0;le<2;++le)for(var ge=Y[le],y=0;y<ge.length;++y){var re=ge[y]&31;pe(t,l,se[re]),l+=D[re],re>15&&(pe(t,l,ge[y]>>>5&127),l+=ge[y]>>>12)}}else E=Rs,F=Te,V=Ns,te=ke;for(var y=0;y<a;++y)if(n[y]>255){var re=n[y]>>>18&31;Ze(t,l,E[re+257]),l+=F[re+257],re>7&&(pe(t,l,n[y]>>>23&31),l+=Ye[re]);var H=n[y]&31;Ze(t,l,V[H]),l+=te[H],H>3&&(Ze(t,l,n[y]>>>5&8191),l+=Xe[H])}else Ze(t,l,E[n[y]]),l+=F[n[y]];return Ze(t,l,E[256]),l+F[256]},Ks=new Ve([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Pe=new M(0),Zs=function(e,t,r,n,s,i){var o=e.length,a=new M(n+o+5*(1+Math.ceil(o/7e3))+s),f=a.subarray(n,a.length-s),u=0;if(!t||o<8)for(var l=0;l<=o;l+=65535){var c=l+65535;c>=o&&(f[u>>3]=i),u=rr(f,u+1,e.subarray(l,c))}else{for(var d=Ks[t-1],h=d>>>13,g=d&8191,v=(1<<r)-1,p=new k(32768),m=new k(v+1),O=Math.ceil(r/3),j=2*O,_=function(Or){return(e[Or]^e[Or+1]<<O^e[Or+2]<<j)&v},I=new Ve(25e3),q=new k(288),A=new k(32),y=0,U=0,l=0,D=0,K=0,B=0;l<o;++l){var x=_(l),C=l&32767,R=m[x];if(p[C]=R,m[x]=C,K<=l){var E=o-l;if((y>7e3||D>24576)&&E>423){u=sn(e,f,0,I,q,A,U,D,B,l-B,u),D=y=U=0,B=l;for(var F=0;F<286;++F)q[F]=0;for(var F=0;F<30;++F)A[F]=0}var V=2,te=0,se=g,Y=C-R&32767;if(E>2&&x==_(l-Y))for(var le=Math.min(h,E)-1,ge=Math.min(32767,l),re=Math.min(258,E);Y<=ge&&--se&&C!=R;){if(e[l+V]==e[l+V-Y]){for(var H=0;H<re&&e[l+H]==e[l+H-Y];++H);if(H>V){if(V=H,te=Y,H>le)break;for(var Ut=Math.min(Y,H-2),ht=0,F=0;F<Ut;++F){var Ee=l-Y+F+32768&32767,ki=p[Ee],Cn=Ee-ki+32768&32767;Cn>ht&&(ht=Cn,R=Ee)}}}C=R,R=p[C],Y+=C-R+32768&32767}if(te){I[D++]=268435456|er[V]<<18|rn[te];var Qn=er[V]&31,Bn=rn[te]&31;U+=Ye[Qn]+Xe[Bn],++q[257+Qn],++A[Bn],K=l+V,++y}else I[D++]=e[l],++q[e[l]]}}u=sn(e,f,i,I,q,A,U,D,B,l-B,u),!i&&u&7&&(u=rr(f,u+1,Pe))}return ae(a,0,n+Dt(u)+s)},Hs=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(r&1&&-306674912)^r>>>1;e[t]=r}return e}(),et=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=Hs[r&255^t[n]]^r>>>8;e=r},d:function(){return~e}}},ln=function(){var e=1,t=0;return{p:function(r){for(var n=e,s=t,i=r.length|0,o=0;o!=i;){for(var a=Math.min(o+2655,i);o<a;++o)s+=n+=r[o];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}e=n,t=s},d:function(){return e%=65521,t%=65521,(e&255)<<24|e>>>8<<16|(t&255)<<8|t>>>8}}},Be=function(e,t,r,n,s){return Zs(e,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+t.mem,r,n,!s)},zt=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Bs=function(e,t,r){for(var n=e(),s=e.toString(),i=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<n.length;++o){var a=n[o],f=i[o];if(typeof a=="function"){t+=";"+f+"=";var u=a.toString();if(a.prototype)if(u.indexOf("[native code]")!=-1){var l=u.indexOf(" ",8)+1;t+=u.slice(l,u.indexOf("(",l))}else{t+=u;for(var c in a.prototype)t+=";"+f+".prototype."+c+"="+a.prototype[c].toString()}else t+=u}else r[f]=a}return[t,r]},Wt=[],Ha=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},ks=function(e,t,r,n){var s;if(!Wt[r]){for(var i="",o={},a=e.length-1,f=0;f<a;++f)s=Bs(e[f],i,o),i=s[0],o=s[1];Wt[r]=Bs(e[a],i,o)}var u=zt({},Wt[r][1]);return Za.default(Wt[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,u,Ha(u),n)},tt=function(){return[M,k,Ve,Ye,Xe,Pt,fn,Ls,$s,Gs,Tt,Js,oe,Vt,ie,Yt,Dt,ae,S,qt,it,ze,cn]},rt=function(){return[M,k,Ve,Ye,Xe,Pt,er,rn,Rs,Te,Ns,ke,Tt,Ks,Pe,oe,pe,Ze,Xt,tr,nn,He,rr,sn,Dt,ae,Zs,Be,It,ze]},Ws=function(){return[hn,gn,Q,et,Hs]},Vs=function(){return[dn,ei]},Ys=function(){return[vn,Q,ln]},Xs=function(){return[ti]},ze=function(e){return postMessage(e,[e.buffer])},cn=function(e){return e&&e.size&&new M(e.size)},nt=function(e,t,r,n,s,i){var o=ks(r,n,s,function(a,f){o.terminate(),i(a,f)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},ue=function(e){return e.ondata=function(t,r){return postMessage([t,r],[t.buffer])},function(t){return e.push(t.data[0],t.data[1])}},st=function(e,t,r,n,s){var i,o=ks(e,n,s,function(a,f){a?(o.terminate(),t.ondata.call(t,a)):(f[1]&&o.terminate(),t.ondata.call(t,a,f[0],f[1]))});o.postMessage(r),t.push=function(a,f){t.ondata||S(5),i&&t.ondata(S(4,0,1),null,!!f),o.postMessage([a,i=f],[a.buffer])},t.terminate=function(){o.terminate()}},X=function(e,t){return e[t]|e[t+1]<<8},N=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},tn=function(e,t){return N(e,t)+N(e,t+4)*4294967296},Q=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},hn=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&Q(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},dn=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&S(6,"invalid gzip data");var t=e[3],r=10;t&4&&(r+=e[10]|(e[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(t&2)},ei=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},gn=function(e){return 10+(e.filename&&e.filename.length+1||0)},vn=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},ti=function(e){((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&S(6,"invalid zlib data"),e[1]&32&&S(6,"invalid zlib data: preset dictionaries not supported")};function pn(e,t){return!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var ye=function(){function e(t,r){!r&&typeof t=="function"&&(r=t,t={}),this.ondata=r,this.o=t||{}}return e.prototype.p=function(t,r){this.ondata(Be(t,this.o,0,0,!r),r)},e.prototype.push=function(t,r){this.ondata||S(5),this.d&&S(4),this.d=r,this.p(t,r||!1)},e}();w.Deflate=ye;var ri=function(){function e(t,r){st([rt,function(){return[ue,ye]}],this,pn.call(this,t,r),function(n){var s=new ye(n.data);onmessage=ue(s)},6)}return e}();w.AsyncDeflate=ri;function ni(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[rt],function(n){return ze(It(n.data[0],n.data[1]))},0,r)}w.deflate=ni;function It(e,t){return Be(e,t||{},0,0)}w.deflateSync=It;var ne=function(){function e(t){this.s={},this.p=new M(0),this.ondata=t}return e.prototype.e=function(t){this.ondata||S(5),this.d&&S(4);var r=this.p.length,n=new M(r+t.length);n.set(this.p),n.set(t,r),this.p=n},e.prototype.c=function(t){this.d=this.s.i=t||!1;var r=this.s.b,n=qt(this.p,this.o,this.s);this.ondata(ae(n,r,this.s.b),this.d),this.o=ae(n,this.s.b-32768),this.s.b=this.o.length,this.p=ae(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(t,r){this.e(t),this.c(r)},e}();w.Inflate=ne;var yn=function(){function e(t){this.ondata=t,st([tt,function(){return[ue,ne]}],this,0,function(){var r=new ne;onmessage=ue(r)},7)}return e}();w.AsyncInflate=yn;function bn(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[tt],function(n){return ze(it(n.data[0],cn(n.data[1])))},1,r)}w.inflate=bn;function it(e,t){return qt(e,t)}w.inflateSync=it;var nr=function(){function e(t,r){this.c=et(),this.l=0,this.v=1,ye.call(this,t,r)}return e.prototype.push=function(t,r){ye.prototype.push.call(this,t,r)},e.prototype.p=function(t,r){this.c.p(t),this.l+=t.length;var n=Be(t,this.o,this.v&&gn(this.o),r&&8,!r);this.v&&(hn(n,this.o),this.v=0),r&&(Q(n,n.length-8,this.c.d()),Q(n,n.length-4,this.l)),this.ondata(n,r)},e}();w.Gzip=nr;w.Compress=nr;var si=function(){function e(t,r){st([rt,Ws,function(){return[ue,ye,nr]}],this,pn.call(this,t,r),function(n){var s=new nr(n.data);onmessage=ue(s)},8)}return e}();w.AsyncGzip=si;w.AsyncCompress=si;function ii(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[rt,Ws,function(){return[sr]}],function(n){return ze(sr(n.data[0],n.data[1]))},2,r)}w.gzip=ii;w.compress=ii;function sr(e,t){t||(t={});var r=et(),n=e.length;r.p(e);var s=Be(e,t,gn(t),8),i=s.length;return hn(s,t),Q(s,i-8,r.d()),Q(s,i-4,n),s}w.gzipSync=sr;w.compressSync=sr;var ir=function(){function e(t){this.v=1,ne.call(this,t)}return e.prototype.push=function(t,r){if(ne.prototype.e.call(this,t),this.v){var n=this.p.length>3?dn(this.p):4;if(n>=this.p.length&&!r)return;this.p=this.p.subarray(n),this.v=0}r&&(this.p.length<8&&S(6,"invalid gzip data"),this.p=this.p.subarray(0,-8)),ne.prototype.c.call(this,r)},e}();w.Gunzip=ir;var oi=function(){function e(t){this.ondata=t,st([tt,Vs,function(){return[ue,ne,ir]}],this,0,function(){var r=new ir;onmessage=ue(r)},9)}return e}();w.AsyncGunzip=oi;function ai(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[tt,Vs,function(){return[or]}],function(n){return ze(or(n.data[0]))},3,r)}w.gunzip=ai;function or(e,t){return qt(e.subarray(dn(e),-8),t||new M(ei(e)))}w.gunzipSync=or;var on=function(){function e(t,r){this.c=ln(),this.v=1,ye.call(this,t,r)}return e.prototype.push=function(t,r){ye.prototype.push.call(this,t,r)},e.prototype.p=function(t,r){this.c.p(t);var n=Be(t,this.o,this.v&&2,r&&4,!r);this.v&&(vn(n,this.o),this.v=0),r&&Q(n,n.length-4,this.c.d()),this.ondata(n,r)},e}();w.Zlib=on;var ka=function(){function e(t,r){st([rt,Ys,function(){return[ue,ye,on]}],this,pn.call(this,t,r),function(n){var s=new on(n.data);onmessage=ue(s)},10)}return e}();w.AsyncZlib=ka;function Wa(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[rt,Ys,function(){return[an]}],function(n){return ze(an(n.data[0],n.data[1]))},4,r)}w.zlib=Wa;function an(e,t){t||(t={});var r=ln();r.p(e);var n=Be(e,t,2,4);return vn(n,t),Q(n,n.length-4,r.d()),n}w.zlibSync=an;var ar=function(){function e(t){this.v=1,ne.call(this,t)}return e.prototype.push=function(t,r){if(ne.prototype.e.call(this,t),this.v){if(this.p.length<2&&!r)return;this.p=this.p.subarray(2),this.v=0}r&&(this.p.length<4&&S(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),ne.prototype.c.call(this,r)},e}();w.Unzlib=ar;var ui=function(){function e(t){this.ondata=t,st([tt,Xs,function(){return[ue,ne,ar]}],this,0,function(){var r=new ar;onmessage=ue(r)},11)}return e}();w.AsyncUnzlib=ui;function fi(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),nt(e,t,[tt,Xs,function(){return[ur]}],function(n){return ze(ur(n.data[0],cn(n.data[1])))},5,r)}w.unzlib=fi;function ur(e,t){return qt((ti(e),e.subarray(2,-4)),t)}w.unzlibSync=ur;var li=function(){function e(t){this.G=ir,this.I=ne,this.Z=ar,this.ondata=t}return e.prototype.push=function(t,r){if(this.ondata||S(5),this.s)this.s.push(t,r);else{if(this.p&&this.p.length){var n=new M(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var s=this,i=function(){s.ondata.apply(s,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(i):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,r),this.p=null}}},e}();w.Decompress=li;var Va=function(){function e(t){this.G=oi,this.I=yn,this.Z=ui,this.ondata=t}return e.prototype.push=function(t,r){li.prototype.push.call(this,t,r)},e}();w.AsyncDecompress=Va;function Ya(e,t,r){return r||(r=t,t={}),typeof r!="function"&&S(7),e[0]==31&&e[1]==139&&e[2]==8?ai(e,t,r):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?bn(e,t,r):fi(e,t,r)}w.decompress=Ya;function Xa(e,t){return e[0]==31&&e[1]==139&&e[2]==8?or(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?it(e,t):ur(e,t)}w.decompressSync=Xa;var mn=function(e,t,r,n){for(var s in e){var i=e[s],o=t+s,a=n;Array.isArray(i)&&(a=zt(n,i[1]),i=i[0]),i instanceof M?r[o]=[i,a]:(r[o+="/"]=[new M(0),a],mn(i,o,r,n))}},Es=typeof TextEncoder<"u"&&new TextEncoder,un=typeof TextDecoder<"u"&&new TextDecoder,ci=0;try{un.decode(Pe,{stream:!0}),ci=1}catch{}var hi=function(e){for(var t="",r=0;;){var n=e[r++],s=(n>127)+(n>223)+(n>239);if(r+s>e.length)return[t,ae(e,r-1)];s?s==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}},eu=function(){function e(t){this.ondata=t,ci?this.t=new TextDecoder:this.p=Pe}return e.prototype.push=function(t,r){if(this.ondata||S(5),r=!!r,this.t){this.ondata(this.t.decode(t,{stream:!0}),r),r&&(this.t.decode().length&&S(8),this.t=null);return}this.p||S(4);var n=new M(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var s=hi(n),i=s[0],o=s[1];r?(o.length&&S(8),this.p=null):this.p=o,this.ondata(i,r)},e}();w.DecodeUTF8=eu;var tu=function(){function e(t){this.ondata=t}return e.prototype.push=function(t,r){this.ondata||S(5),this.d&&S(4),this.ondata(qe(t),this.d=r||!1)},e}();w.EncodeUTF8=tu;function qe(e,t){if(t){for(var r=new M(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(Es)return Es.encode(e);for(var s=e.length,i=new M(e.length+(e.length>>1)),o=0,a=function(l){i[o++]=l},n=0;n<s;++n){if(o+5>i.length){var f=new M(o+8+(s-n<<1));f.set(i),i=f}var u=e.charCodeAt(n);u<128||t?a(u):u<2048?(a(192|u>>6),a(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|e.charCodeAt(++n)&1023,a(240|u>>18),a(128|u>>12&63),a(128|u>>6&63),a(128|u&63)):(a(224|u>>12),a(128|u>>6&63),a(128|u&63))}return ae(i,0,o)}w.strToU8=qe;function Sn(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(un)return un.decode(e);var s=hi(e),i=s[0],o=s[1];return o.length&&S(8),i}}w.strFromU8=Sn;var di=function(e){return e==1?3:e<6?2:e==9?1:0},gi=function(e,t){return t+30+X(e,t+26)+X(e,t+28)},vi=function(e,t,r){var n=X(e,t+28),s=Sn(e.subarray(t+46,t+46+n),!(X(e,t+8)&2048)),i=t+46+n,o=N(e,t+20),a=r&&o==4294967295?pi(e,i):[o,N(e,t+24),N(e,t+42)],f=a[0],u=a[1],l=a[2];return[X(e,t+10),f,u,s,i+X(e,t+30)+X(e,t+32),l]},pi=function(e,t){for(;X(e,t)!=1;t+=4+X(e,t+2));return[tn(e,t+12),tn(e,t+4),tn(e,t+20)]},De=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;n>65535&&S(9),t+=n+4}return t},We=function(e,t,r,n,s,i,o,a){var f=n.length,u=r.extra,l=a&&a.length,c=De(u);Q(e,t,o!=null?33639248:67324752),t+=4,o!=null&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(i<0&&8),e[t++]=s&&8,e[t++]=r.compression&255,e[t++]=r.compression>>8;var d=new Date(r.mtime==null?Date.now():r.mtime),h=d.getFullYear()-1980;if((h<0||h>119)&&S(10),Q(e,t,h<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,i!=-1&&(Q(e,t,r.crc),Q(e,t+4,i<0?-i-2:i),Q(e,t+8,r.size)),Q(e,t+12,f),Q(e,t+14,c),t+=16,o!=null&&(Q(e,t,l),Q(e,t+6,r.attrs),Q(e,t+10,o),t+=14),e.set(n,t),t+=f,c)for(var g in u){var v=u[g],p=v.length;Q(e,t,+g),Q(e,t+2,p),e.set(v,t+4),t+=4+p}return l&&(e.set(a,t),t+=l),t},_n=function(e,t,r,n,s){Q(e,t,101010256),Q(e,t+8,r),Q(e,t+10,r),Q(e,t+12,n),Q(e,t+16,s)},At=function(){function e(t){this.filename=t,this.c=et(),this.size=0,this.compression=0}return e.prototype.process=function(t,r){this.ondata(null,t,r)},e.prototype.push=function(t,r){this.ondata||S(5),this.c.p(t),this.size+=t.length,r&&(this.crc=this.c.d()),this.process(t,r||!1)},e}();w.ZipPassThrough=At;var ru=function(){function e(t,r){var n=this;r||(r={}),At.call(this,t),this.d=new ye(r,function(s,i){n.ondata(null,s,i)}),this.compression=8,this.flag=di(r.level)}return e.prototype.process=function(t,r){try{this.d.push(t,r)}catch(n){this.ondata(n,null,r)}},e.prototype.push=function(t,r){At.prototype.push.call(this,t,r)},e}();w.ZipDeflate=ru;var nu=function(){function e(t,r){var n=this;r||(r={}),At.call(this,t),this.d=new ri(r,function(s,i,o){n.ondata(s,i,o)}),this.compression=8,this.flag=di(r.level),this.terminate=this.d.terminate}return e.prototype.process=function(t,r){this.d.push(t,r)},e.prototype.push=function(t,r){At.prototype.push.call(this,t,r)},e}();w.AsyncZipDeflate=nu;var su=function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var r=this;if(this.ondata||S(5),this.d&2)this.ondata(S(4+(this.d&1)*8,0,1),null,!1);else{var n=qe(t.filename),s=n.length,i=t.comment,o=i&&qe(i),a=s!=t.filename.length||o&&i.length!=o.length,f=s+De(t.extra)+30;s>65535&&this.ondata(S(11,0,1),null,!1);var u=new M(f);We(u,0,t,n,a,-1);var l=[u],c=function(){for(var p=0,m=l;p<m.length;p++){var O=m[p];r.ondata(null,O,!1)}l=[]},d=this.d;this.d=0;var h=this.u.length,g=zt(t,{f:n,u:a,o,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),d){var p=r.u[h+1];p?p.r():r.d=1}d=1}}),v=0;t.ondata=function(p,m,O){if(p)r.ondata(p,m,O),r.terminate();else if(v+=m.length,l.push(m),O){var j=new M(16);Q(j,0,134695760),Q(j,4,t.crc),Q(j,8,v),Q(j,12,t.size),l.push(j),g.c=v,g.b=f+v+16,g.crc=t.crc,g.size=t.size,d&&g.r(),d=1}else d&&c()},this.u.push(g)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(S(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,r=0,n=0,s=0,i=this.u;s<i.length;s++){var o=i[s];n+=46+o.f.length+De(o.extra)+(o.o?o.o.length:0)}for(var a=new M(n+22),f=0,u=this.u;f<u.length;f++){var o=u[f];We(a,t,o,o.f,o.u,-o.c-2,r,o.o),t+=46+o.f.length+De(o.extra)+(o.o?o.o.length:0),r+=o.b}_n(a,t,this.u.length,n,r),this.ondata(null,a,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,r=this.u;t<r.length;t++){var n=r[t];n.t()}this.d=2},e}();w.Zip=su;function iu(e,t,r){r||(r=t,t={}),typeof r!="function"&&S(7);var n={};mn(e,"",n,t);var s=Object.keys(n),i=s.length,o=0,a=0,f=i,u=new Array(i),l=[],c=function(){for(var p=0;p<l.length;++p)l[p]()},d=function(p,m){fr(function(){r(p,m)})};fr(function(){d=r});var h=function(){var p=new M(a+22),m=o,O=a-o;a=0;for(var j=0;j<f;++j){var _=u[j];try{var I=_.c.length;We(p,a,_,_.f,_.u,I);var q=30+_.f.length+De(_.extra),A=a+q;p.set(_.c,A),We(p,o,_,_.f,_.u,I,a,_.m),o+=16+q+(_.m?_.m.length:0),a=A+I}catch(y){return d(y,null)}}_n(p,o,u.length,O,m),d(null,p)};i||h();for(var g=function(p){var m=s[p],O=n[m],j=O[0],_=O[1],I=et(),q=j.length;I.p(j);var A=qe(m),y=A.length,U=_.comment,D=U&&qe(U),K=D&&D.length,B=De(_.extra),x=_.level==0?0:8,C=function(R,E){if(R)c(),d(R,null);else{var F=E.length;u[p]=zt(_,{size:q,crc:I.d(),c:E,f:A,m:D,u:y!=m.length||D&&U.length!=K,compression:x}),o+=30+y+B+F,a+=76+2*(y+B)+(K||0)+F,--i||h()}};if(y>65535&&C(S(11,0,1),null),!x)C(null,j);else if(q<16e4)try{C(null,It(j,_))}catch(R){C(R,null)}else l.push(ni(j,_,C))},v=0;v<f;++v)g(v);return c}w.zip=iu;function ou(e,t){t||(t={});var r={},n=[];mn(e,"",r,t);var s=0,i=0;for(var o in r){var a=r[o],f=a[0],u=a[1],l=u.level==0?0:8,c=qe(o),d=c.length,h=u.comment,g=h&&qe(h),v=g&&g.length,p=De(u.extra);d>65535&&S(11);var m=l?It(f,u):f,O=m.length,j=et();j.p(f),n.push(zt(u,{size:f.length,crc:j.d(),c:m,f:c,m:g,u:d!=o.length||g&&h.length!=v,o:s,compression:l})),s+=30+d+p+O,i+=76+2*(d+p)+(v||0)+O}for(var _=new M(i+22),I=s,q=i-s,A=0;A<n.length;++A){var c=n[A];We(_,c.o,c,c.f,c.u,c.c.length);var y=30+c.f.length+De(c.extra);_.set(c.c,c.o+y),We(_,s,c,c.f,c.u,c.c.length,c.o,c.m),s+=16+y+(c.m?c.m.length:0)}return _n(_,s,n.length,q,I),_}w.zipSync=ou;var yi=function(){function e(){}return e.prototype.push=function(t,r){this.ondata(null,t,r)},e.compression=0,e}();w.UnzipPassThrough=yi;var au=function(){function e(){var t=this;this.i=new ne(function(r,n){t.ondata(null,r,n)})}return e.prototype.push=function(t,r){try{this.i.push(t,r)}catch(n){this.ondata(n,null,r)}},e.compression=8,e}();w.UnzipInflate=au;var uu=function(){function e(t,r){var n=this;r<32e4?this.i=new ne(function(s,i){n.ondata(null,s,i)}):(this.i=new yn(function(s,i,o){n.ondata(s,i,o)}),this.terminate=this.i.terminate)}return e.prototype.push=function(t,r){this.i.terminate&&(t=ae(t,0)),this.i.push(t,r)},e.compression=8,e}();w.AsyncUnzipInflate=uu;var fu=function(){function e(t){this.onfile=t,this.k=[],this.o={0:yi},this.p=Pe}return e.prototype.push=function(t,r){var n=this;if(this.onfile||S(5),this.p||S(4),this.c>0){var s=Math.min(this.c,t.length),i=t.subarray(0,s);if(this.c-=s,this.d?this.d.push(i,!this.c):this.k[0].push(i),t=t.subarray(s),t.length)return this.push(t,r)}else{var o=0,a=0,f=void 0,u=void 0;this.p.length?t.length?(u=new M(this.p.length+t.length),u.set(this.p),u.set(t,this.p.length)):u=this.p:u=t;for(var l=u.length,c=this.c,d=c&&this.d,h=function(){var m,O=N(u,a);if(O==67324752){o=1,f=a,g.d=null,g.c=0;var j=X(u,a+6),_=X(u,a+8),I=j&2048,q=j&8,A=X(u,a+26),y=X(u,a+28);if(l>a+30+A+y){var U=[];g.k.unshift(U),o=2;var D=N(u,a+18),K=N(u,a+22),B=Sn(u.subarray(a+30,a+=30+A),!I);D==4294967295?(m=q?[-2]:pi(u,a),D=m[0],K=m[1]):q&&(D=-1),a+=y,g.c=D;var x,C={name:B,compression:_,start:function(){if(C.ondata||S(5),!D)C.ondata(null,Pe,!0);else{var R=n.o[_];R||C.ondata(S(14,"unknown compression type "+_,1),null,!1),x=D<0?new R(B):new R(B,D,K),x.ondata=function(te,se,Y){C.ondata(te,se,Y)};for(var E=0,F=U;E<F.length;E++){var V=F[E];x.push(V,!1)}n.k[0]==U&&n.c?n.d=x:x.push(Pe,!0)}},terminate:function(){x&&x.terminate&&x.terminate()}};D>=0&&(C.size=D,C.originalSize=K),g.onfile(C)}return"break"}else if(c){if(O==134695760)return f=a+=12+(c==-2&&8),o=3,g.c=0,"break";if(O==33639248)return f=a-=4,o=3,g.c=0,"break"}},g=this;a<l-4;++a){var v=h();if(v==="break")break}if(this.p=Pe,c<0){var p=o?u.subarray(0,f-12-(c==-2&&8)-(N(u,f-16)==134695760&&4)):u.subarray(0,a);d?d.push(p,!!o):this.k[+(o==2)].push(p)}if(o&2)return this.push(u.subarray(a),r);this.p=u.subarray(a)}r&&(this.c&&S(13),this.p=null)},e.prototype.register=function(t){this.o[t.compression]=t},e}();w.Unzip=fu;var fr=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function lu(e,t,r){r||(r=t,t={}),typeof r!="function"&&S(7);var n=[],s=function(){for(var p=0;p<n.length;++p)n[p]()},i={},o=function(p,m){fr(function(){r(p,m)})};fr(function(){o=r});for(var a=e.length-22;N(e,a)!=101010256;--a)if(!a||e.length-a>65558)return o(S(13,0,1),null),s;var f=X(e,a+8);if(f){var u=f,l=N(e,a+16),c=l==4294967295||u==65535;if(c){var d=N(e,a-12);c=N(e,d)==101075792,c&&(u=f=N(e,d+32),l=N(e,d+48))}for(var h=t&&t.filter,g=function(p){var m=vi(e,l,c),O=m[0],j=m[1],_=m[2],I=m[3],q=m[4],A=m[5],y=gi(e,A);l=q;var U=function(K,B){K?(s(),o(K,null)):(B&&(i[I]=B),--f||o(null,i))};if(!h||h({name:I,size:j,originalSize:_,compression:O}))if(!O)U(null,ae(e,y,y+j));else if(O==8){var D=e.subarray(y,y+j);if(j<32e4)try{U(null,it(D,new M(_)))}catch(K){U(K,null)}else n.push(bn(D,{size:_},U))}else U(S(14,"unknown compression type "+O,1),null);else U(null,null)},v=0;v<u;++v)g(v)}else o(null,{});return s}w.unzip=lu;function cu(e,t){for(var r={},n=e.length-22;N(e,n)!=101010256;--n)(!n||e.length-n>65558)&&S(13);var s=X(e,n+8);if(!s)return{};var i=N(e,n+16),o=i==4294967295||s==65535;if(o){var a=N(e,n-12);o=N(e,a)==101075792,o&&(s=N(e,a+32),i=N(e,a+48))}for(var f=t&&t.filter,u=0;u<s;++u){var l=vi(e,i,o),c=l[0],d=l[1],h=l[2],g=l[3],v=l[4],p=l[5],m=gi(e,p);i=v,(!f||f({name:g,size:d,originalSize:h,compression:c}))&&(c?c==8?r[g]=it(e.subarray(m,m+d),new M(h)):S(14,"unknown compression type "+c):r[g]=ae(e,m,m+d))}return r}w.unzipSync=cu});var Si=b($=>{"use strict";var hu=$&&$.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),du=$&&$.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),gu=$&&$.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&hu(t,e,r);return du(t,e),t};Object.defineProperty($,"__esModule",{value:!0});$.initStorageBrowser=$.setStorageBrowser=$.clearStorageBrowser=$.removeStorageBrowser=void 0;var mi=gu(lr()),cr=ve(),vu=e=>{let t=(0,cr.decodeBase64)(e),r=(0,cr.uft8ToString)(mi.inflateSync(t));return JSON.parse(r)},pu=(e,t)=>{let r=localStorage.getItem(t);r&&(e.storageSize-=new Blob([r]).size,localStorage.setItem("@based-size",String(e.storageSize)),localStorage.removeItem(t))};$.removeStorageBrowser=pu;var yu=()=>{let e=Object.keys(localStorage);try{for(let t of e)t.startsWith("@based")&&localStorage.removeItem(t)}catch{try{localStorage.clear()}catch{console.error("Based - Error clearing localStorage")}}};$.clearStorageBrowser=yu;var bu=(e,t,r)=>{try{let n=e.storageEnvKey;if(!n)return;let s=localStorage.getItem(t),i=JSON.stringify(r),o=i.length>70||t==="@based-authState-"+n?(0,cr.encodeBase64)(mi.deflateSync((0,cr.stringToUtf8)(i))):i,f=new Blob([o]).size;s&&(e.storageSize-=new Blob([s]).size),e.storageSize+=f,e.storageSize>e.maxStorageSize&&(console.info("Based - Max localStorage size reached - clear"),(0,$.clearStorageBrowser)(),e.storageSize=0,e.authState.persistent===!0&&(0,$.setStorageBrowser)(e,"@based-authState-"+n,e.authState),e.storageSize+=f),localStorage.setItem("@based-size",String(e.storageSize)),localStorage.setItem(t,o)}catch(n){console.error(`Based - Error writing ${t} to localStorage`,n)}};$.setStorageBrowser=bu;var bi=(e,t)=>{let r=e.storageEnvKey;if(r)try{let n=localStorage.getItem(t);if(n!==void 0){if(n.length<70&&t!=="@based-authState-"+r)try{return JSON.parse(n)}catch{}return vu(n)}return}catch{console.error(`Based - Error parsing ${t} from localStorage`)}},mu=async e=>{let t=e.storageEnvKey;if(!t)return;let r=global.__basedcache__??{};for(let n in r)e.cache.set(Number(n),r[n]);try{let n=Number(localStorage.getItem("@based-size")||0);n<0&&(console.error("Based - Corrupt localStorage (negative size) - clear"),(0,$.clearStorageBrowser)(),n=0),e.storageSize=n;let s=Object.keys(localStorage);if(s.length===1&&n>0&&(console.error("Based - Corrupt localStorage (size but no keys) - clear",n),(0,$.clearStorageBrowser)(),n=0),console.info(`Based - init localstorage stored ${~~(n/1024)+"kb"}`),n>0)for(let i of s){if(i==="@based-size"||!i.startsWith("@based"))continue;if(i==="@based-authState-"+t){let l=bi(e,i);l&&e.setAuthState(l).catch(c=>{console.error(c.message),(0,$.removeStorageBrowser)(e,i)});continue}let[,o]=i.split("@based-cache-");if(!o)continue;let[a,f]=o.split("-");if(f!==String(t))continue;if(!a){console.warn("Based - clear corrupt localStorage item"),(0,$.removeStorageBrowser)(e,i);continue}let u=bi(e,i);e.cache.set(Number(a),u)}}catch{console.error("Based - Cannot read localStorage")}};$.initStorageBrowser=mu});var ot=b(()=>{});var Qt=b(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.clearStorage=fe.initStorage=fe.updateStorage=fe.setStorage=fe.removeStorage=void 0;var hr=Si(),Ct=typeof window<"u",Su=(e,t)=>{let r=e.storageEnvKey;r&&(Ct?(t+="-"+r,(0,hr.removeStorageBrowser)(e,t)):e.storagePath&&ot().removeStorageNode(e,t))};fe.removeStorage=Su;var _u=(e,t,r)=>{let n=e.storageEnvKey;n&&(Ct?(t+="-"+n,(0,hr.setStorageBrowser)(e,t,r)):e.storagePath&&ot().setStorageNode(e,t,r))};fe.setStorage=_u;var wu=async e=>{if(!Ct){if(e.storagePath)return ot().store(e)}};fe.updateStorage=wu;var Ou=async e=>{if(Ct)return(0,hr.initStorageBrowser)(e);if(e.storagePath)return ot().initStorageNode(e)};fe.initStorage=Ou;var ju=async e=>{if(Ct)return(0,hr.clearStorageBrowser)();if(e.storagePath)return ot().clearStorageNode(e)};fe.clearStorage=ju});var wn=b(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.updateAuthState=void 0;var _i=Qt(),Mu=(e,t)=>{t.persistent?(0,_i.setStorage)(e,"@based-authState",t):(0,_i.removeStorage)(e,"@based-authState"),e.authState=t};dr.updateAuthState=Mu});var On=b(J=>{"use strict";var Pu=J&&J.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Tu=J&&J.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Au=J&&J.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Pu(t,e,r);return Tu(t,e),t};Object.defineProperty(J,"__esModule",{value:!0});J.encodeAuthMessage=J.encodePublishMessage=J.encodeFunctionMessage=J.encodeObserveMessage=J.encodeSubscribeChannelMessage=J.encodeGetObserveMessage=void 0;var Du=Au(lr()),Bt=new TextEncoder,Z=(e,t,r,n)=>{for(let s=r;s<r+n;s++){let i=t&255;e[s]=i,t=(t-i)/256}},Ie=(e,t,r)=>{let n=(e<<1)+(t|0);return(r<<4)+n},at=(e,t=!1)=>{let r,n=!1;return e!==void 0?(r=Bt.encode(typeof e=="string"?e:JSON.stringify(e)),!t&&r.length>150&&(r=Du.deflateSync(r),n=!0),[n,r]):[!1]},qu=(e,t)=>{let r=4,[n,s,i,o]=t;if(n===3){let a=Bt.encode(s);r+=1+a.length;let[f,u]=at(o);u&&(r+=u.length);let l=16;r+=l;let c=Ie(n,f,r),d=new Uint8Array(1+4+l);return Z(d,c,0,4),Z(d,e,4,8),Z(d,i,12,8),d[20]=a.length,u?{buffers:[d,a,u],len:r}:{buffers:[d,a],len:r}}return{buffers:[],len:0}};J.encodeGetObserveMessage=qu;var zu=(e,t)=>{let r=4,[n,s,i]=t;if(n===7){let d=Ie(n,!1,12),h=new Uint8Array(4+8);return Z(h,d,0,4),Z(h,e,4,8),{buffers:[h],len:12}}let o=Bt.encode(s);r+=1+o.length;let a=n===6,[,f]=at(i,!0);f&&(r+=f.length);let u=8;r+=u;let l=Ie(5,a,r),c=new Uint8Array(1+4+u);return Z(c,l,0,4),Z(c,e,4,8),c[12]=o.length,f?{buffers:[c,o,f],len:r}:{buffers:[c,o],len:r}};J.encodeSubscribeChannelMessage=zu;var Iu=(e,t)=>{let r=4,[n,s,i,o]=t;if(n===2){let h=Ie(n,!1,12),g=new Uint8Array(4+8);return Z(g,h,0,4),Z(g,e,4,8),{buffers:[g],len:12}}let a=Bt.encode(s);r+=1+a.length;let[f,u]=at(o);u&&(r+=u.length);let l=16;r+=l;let c=Ie(n,f,r),d=new Uint8Array(1+4+l);return Z(d,c,0,4),Z(d,e,4,8),Z(d,i,12,8),d[20]=a.length,u?{buffers:[d,a,u],len:r}:{buffers:[d,a],len:r}};J.encodeObserveMessage=Iu;var Cu=e=>{let t=7,[r,n,s]=e,i=Bt.encode(n);t+=1+i.length;let[o,a]=at(s);a&&(t+=a.length);let f=Ie(0,o,t),u=new Uint8Array(4+3+1);return Z(u,f,0,4),Z(u,r,4,3),u[7]=i.length,a?{buffers:[u,i,a],len:t}:{buffers:[u,i],len:t}};J.encodeFunctionMessage=Cu;var Qu=e=>{let t=12,[r,n]=e,[s,i]=at(n);i&&(t+=i.length);let o=Ie(6,s,t),a=new Uint8Array(4+8);return Z(a,o,0,4),Z(a,r,4,8),i?{buffers:[a,i],len:t}:{buffers:[a],len:t}};J.encodePublishMessage=Qu;var Bu=e=>{let t=4,[r,n]=at(e);n&&(t+=n.length);let s=Ie(4,r,t),i=new Uint8Array(t);return Z(i,s,0,4),n&&i.set(n,4),i};J.encodeAuthMessage=Bu});var Et=b(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.sendAuth=T.addGetToQueue=T.addObsToQueue=T.addObsCloseToQueue=T.addToPublishQueue=T.addChannelPublishIdentifier=T.addChannelSubscribeToQueue=T.addChannelCloseToQueue=T.addToFunctionQueue=T.stopDrainQueue=T.drainQueue=T.idleTimeout=void 0;var Eu=wn(),ut=On(),Uu=ve(),xu=new Uint8Array(0),Fu=e=>{clearTimeout(e.idlePing),e.idlePing=setTimeout(()=>{e.connection&&e.connected&&!e.connection.disconnected&&e.connection.ws.send(xu)},6e4)};T.idleTimeout=Fu;var Lu=e=>{if(e.connected&&!e.drainInProgress&&(e.functionQueue.length||e.observeQueue.size||e.getObserveQueue.size||e.channelQueue.size||e.publishQueue.length)){e.drainInProgress=!0;let t=()=>{if(e.drainInProgress=!1,!e.connected)return;let r=e.listeners.debug;if(e.functionQueue.length||e.observeQueue.size||e.getObserveQueue.size||e.channelQueue.size||e.publishQueue.length){let n=e.channelQueue,s=e.publishQueue,i=e.functionQueue,o=e.observeQueue,a=e.getObserveQueue,f=[],u=0;for(let[d,h]of n){let{buffers:g,len:v}=(0,ut.encodeSubscribeChannelMessage)(d,h);f.push(...g),u+=v}for(let[d,h]of a){let{buffers:g,len:v}=(0,ut.encodeGetObserveMessage)(d,h);f.push(...g),u+=v}for(let[d,h]of o){let{buffers:g,len:v}=(0,ut.encodeObserveMessage)(d,h);f.push(...g),u+=v}for(let d of i){let{buffers:h,len:g}=(0,ut.encodeFunctionMessage)(d);f.push(...h),u+=g}for(let d of s){let{buffers:h,len:g}=(0,ut.encodePublishMessage)(d);f.push(...h),u+=g}let l=new Uint8Array(u),c=0;for(let d of f)l.set(d,c),c+=d.length;e.functionQueue=[],e.publishQueue=[],e.observeQueue.clear(),e.getObserveQueue.clear(),e.channelQueue.clear(),e.connection.ws.send(l),(0,T.idleTimeout)(e)}};e.drainTimeout=setTimeout(t,0)}};T.drainQueue=Lu;var Ru=e=>{e.drainInProgress&&(clearTimeout(e.drainTimeout),e.drainInProgress=!1)};T.stopDrainQueue=Ru;var $u=(e,t,r,n,s)=>{e.requestId++,e.requestId>16777215&&(e.requestId=0);let i=e.requestId,o=Error().stack.split(/BasedClient\.function.+:\d\d\)/)[1];e.functionResponseListeners.set(i,[n,s,o]),e.functionQueue.push([i,r,t]),(0,T.drainQueue)(e)};T.addToFunctionQueue=$u;var Nu=(e,t)=>{e.channelQueue.get(t)?.[0]!==7&&(e.channelQueue.set(t,[7]),(0,T.drainQueue)(e))};T.addChannelCloseToQueue=Nu;var Gu=(e,t,r,n)=>{e.channelQueue.get(r)?.[0]!==5&&(e.channelQueue.set(r,[5,t,n]),(0,T.drainQueue)(e))};T.addChannelSubscribeToQueue=Gu;var Ju=(e,t,r,n)=>{let s=e.channelQueue.get(r)?.[0];s===5||s===6||(s===7&&console.warn("Case not handled yet... ubsub and req for info for channel"),e.channelQueue.set(r,[6,t,n]),(0,T.drainQueue)(e))};T.addChannelPublishIdentifier=Ju;var Ku=(e,t,r)=>{e.publishQueue.length>e.maxPublishQueue&&e.publishQueue.shift(),e.publishQueue.push([t,r]),(0,T.drainQueue)(e)};T.addToPublishQueue=Ku;var Zu=(e,t)=>{e.observeQueue.get(t)?.[0]!==2&&(e.observeQueue.set(t,[2]),(0,T.drainQueue)(e))};T.addObsCloseToQueue=Zu;var Hu=(e,t,r,n,s=0)=>{e.observeQueue.get(r)?.[0]!==1&&(e.observeQueue.set(r,[1,t,s,n]),(0,T.drainQueue)(e))};T.addObsToQueue=Hu;var ku=(e,t,r,n,s=0)=>{e.getObserveQueue.has(r)||(e.getObserveQueue.set(r,[3,t,s,n]),(0,T.drainQueue)(e))};T.addGetToQueue=ku;var Wu=async(e,t)=>(0,Uu.deepEqual)(t,e.authState)?(console.warn("[Based] Trying to send the same authState twice",e.authState),e.authRequest.inProgress?e.authRequest.promise:new Promise(r=>r({}))):(e.authRequest.inProgress&&(console.warn("[Based] Authentication still in progress - waiting until done"),await e.authRequest.promise),(0,Eu.updateAuthState)(e,t),e.emit("authstate-change",e.authState),e.connected&&e.connection.ws.send((0,ut.encodeAuthMessage)(t)),e.authRequest.promise=new Promise((r,n)=>{e.authRequest.inProgress=!0,e.authRequest.resolve=r,e.authRequest.reject=n}).finally(()=>{e.authRequest.resolve=null,e.authRequest.reject=null,e.authRequest.inProgress=!1}),e.authRequest.promise);T.sendAuth=Wu});var Pi=b(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});var wi=ve(),Oi=(e,t,r)=>{if(r.constructor===Array){let n=r[0];if(n===0)e[t]=r[1];else if(n===1)delete e[t];else if(n===2){let s=ji(e[t],r[1]);if(s===null)return null;e[t]=s}}else{if(r.___$toObject&&e[t]&&e[t].constructor===Array){let n={};for(let s=0;s<e[t].length;s++)n[s]=e[t][s];e[t]=n}if(e[t]===void 0)return console.warn("Diff apply patch: Cannot find key in original object",t,JSON.stringify(r,null,2)),null;for(let n in r)if(n!=="___$toObject"&&Oi(e[t],n,r[n])===null)return null}},ji=(e,t)=>{let r=t.length,n=new Array(t[0]),s=-1,i=[],o={};for(let f=1;f<r;f++){let u=t[f],l=u[0];if(l===0)for(let c=1;c<u.length;c++)n[++s]=u[c];else if(l===1){let c=u[2],d=u[1]+c;for(let h=c;h<d;h++){let g=typeof e[h];if(g==="object"&&h in o){let v=wi.deepCopy(e[h]);n[++s]=v}else g==="object"&&(o[h]=!0),n[++s]=e[h]}}else if(l===2){let c=u[1],d=u.length-2+c;for(let h=c;h<d;h++){let g=[++s,h,u[h-c+2]];i.push(g)}}}let a=i.length;for(let f=0;f<a;f++){let[u,l,c]=i[f],d=l in o?wi.deepCopy(e[l]):e[l],h=Mi(d,c);if(h===null)return null;n[u]=h}return n},Mi=(e,t)=>{if(t)if(t.constructor===Array){let r=t[0];if(r===0)return t[1];if(r===1)return;if(r===2)return ji(e,t[1])}else{if(t.___$toObject&&e&&e.constructor===Array){let r={};for(let n=0;n<e.length;n++)r[n]=e[n];e=r}for(let r in t)if(r!=="___$toObject"&&Oi(e,r,t[r])===null)return null;return e}else return e};jn.default=Mi});var Ai=b(ft=>{"use strict";var Vu=ft&&ft.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ft,"__esModule",{value:!0});ft.execCreatePartialDiff=void 0;var Ti=ve(),Yu=Vu(Mn()),Xu=(e,t,r)=>{let n=e(t);if(n!==!1)if(n.type==="array"){let s=[];if(!Array.isArray(t))return s[0]=0,console.log("no current value do something..."),s;s[0]=2;let i=[t.length];s[1]=i,n.values.sort((c,d)=>c.index<d.index?-1:c.index===d.index?0:1);let o=0,a,f=0,u=0,l=!0;for(let c of n.values){let d=c.type,h=c.index;if(f){if(h+f>o+1){let g=h-o-1;g>0&&(u+=g,i.push([1,h-o-1,o+1]))}}else if(a?h>o:h>o+1)if(a)if(d==="insert"){let g=h-o-1;i[0]++,g>0&&(u+=g,i.push([1,g,o+1]))}else{let g=h-o;g>0&&(u+=g,i.push([1,g,o+1]))}else{let g=h-o;g>0&&(u+=g,i.push([1,g,o]))}if(d==="delete")i[0]--,a=!0,l=!1,f&&i.length>1&&i[i.length-1][0]===1&&i[i.length-1][2]--,f=0;else{if(d==="update"||d==="merge"){l=!0;let g=!1,v=c.value;if(d==="merge"){let m=c.fromIndex||h;if(!(!t[m]||typeof t[m]!="object")){let O=Ti.deepMerge(Ti.deepCopy(t[m]),v);v=[2,m,Yu.default(t[m],O)],g=!0}}let p=i[i.length-1];!g&&i.length>1&&p[0]===0?(p.push(v),u++,h++):(o===0&&h===1&&!a&&(i.push([1,1,0]),u++),u++,g?i.push(v):i.push([0,v]),h++)}else if(d==="insert"){l=!1;let g=i.length,v;g>1&&(v=i[g-1]),g>1&&v[0]===0?c.values?(f=c.values.length,i[0]+=c.values.length,v.push(...c.values)):(i[0]++,f=1,v.push(c.value)):c.values?(f=c.values.length,i[0]+=c.values.length,i.push([0].concat(c.values))):(i[0]++,f=1,i.push([0,c.value])),u+=f}a=!1}o=h}if(u<i[0]){let c=i[0]-u;a||l?c>0&&i.push([1,c,o+1]):c>0&&i.push([1,c,o])}return s}else{if(n.type==="update")return[0,n.value];if(n.type==="delete")return[1]}};ft.execCreatePartialDiff=Xu});var Ci=b(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.createPatch=he.arrayDiff=void 0;var ef=Ce(),qi=Ai(),Di=e=>e===null?"___isNull$":e===!1?"___isFalse$":e===!0?"___isTrue$":typeof e=="object"&&e!==null?"___obj"+ef.hashObject(e):e,tf=(e,t,r)=>{let n=e.length,s=t.length,i={},o=new Array(n);for(let l=0;l<n;l++){let c=Di(e[l]);i[c]||(i[c]=[]),i[c].push(l),o[l]=c}let a=[],f=0;a[0]=s;for(let l=0;l<s;l++){let c=o[l],d=Di(t[l]),h=a[f],g=a[f]&&a[f][0];if(c===d){let v=!1;if(g===1){let p=h[2];for(let m=0;m<p.length;m++){let O=p[m];if(O+h[1]===l){v=O;break}}}v!==!1?(h[1]++,h[2]=[v]):v===!1&&(g===1&&(h[2]=h[2][0]),f++,a[f]=[1,1,[l]])}else if(i[d]){let v=!1;if(g===1)for(let p=0;p<i[d].length;p++){let m=i[d][p],O=h[2],j=!1;for(let _=0;_<O.length;_++){let I=O[_];if(I+h[1]===m){v=I,j=!0;break}}if(j)break}v!==!1?(h[1]++,h[2]=[v]):v===!1&&(g===1&&(h[2]=h[2][0]),f++,a[f]=[1,1,i[d]])}else if(g===1&&(h[2]=h[2][0]),typeof e[l]=="object"&&typeof t[l]=="object"){let v=he.createPatch(e[l],t[l],r);g===2?h.push(v):(f++,a[f]=[2,l,v])}else g===0?h.push(t[l]):(f++,a[f]=[0,t[l]])}let u=a[a.length-1];if(u[0]===1&&(u[2]=u[2][0]),!(a.length===2&&a[1][0]===1&&a[1][1]===a[0]&&a[1][2]===0&&a[0]===n))return a};he.arrayDiff=tf;var zi=(e,t,r,n,s)=>{let i=typeof t;if(i==="function"&&s&&s.parseDiffFunctions){let o=qi.execCreatePartialDiff(t,e,s);o&&(r[n]=o)}else if(i!==typeof e)r[n]=[0,t];else if(i==="object")if(t===null)r[n]=[0,null];else{let o;if(t.constructor===Array)if(t.length===0)e&&e.constructor===Array&&e.length===0||(o=[0,[]],r[n]=o);else if(e&&e.constructor===Array){let a=he.arrayDiff(e,t,s);a&&a.length>1&&(o=[2,a],r[n]=o)}else{let a=he.arrayDiff(e,t,s);a&&a.length>1&&(o=[0,a],r[n]=o)}else{o={},e&&e.constructor===Array&&e.length&&(o.___$toObject=!0);for(let a in t)a in e?zi(e[a],t[a],o,a,s):o[a]=[0,t[a]];for(let a in e)a in t||(o[a]=[1]);for(let a in o){r[n]=o;break}}}else e===t||(r[n]=[0,t])},Ii=(e,t,r)=>{let n=e[t];if(n){let s=typeof n;if(s==="function"){let i=qi.execCreatePartialDiff(e[t],void 0,r);console.log(i),i?e[t]=i[1]:delete e[t]}else if(s==="object")for(let i in n)Ii(n,i,r)}},rf=(e,t,r)=>{let n=typeof t;if(n!==typeof e)return[0,t];if(n==="object"){if(t===null)return[0,null];if(t.constructor===Array){if(t.length===0)return e.constructor===Array&&e.length===0?void 0:[0,t];if(e.constructor===Array){let s=he.arrayDiff(e,t,r);if(s&&s.length>1)return[2,he.arrayDiff(e,t,r)]}else return[0,t]}else{let s={};e.constructor===Array&&(s.___$toObject=!0);for(let i in t)i in e?zi(e[i],t[i],s,i,r):(r&&r.parseDiffFunctions&&Ii(t,i,r),s[i]=[0,t[i]]);for(let i in e)i in t||(s[i]=[1]);for(let i in s)return s}}else if(e!==t)return[0,t]};he.createPatch=rf});var Mn=b(de=>{"use strict";var nf=de&&de.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(de,"__esModule",{value:!0});de.createPatch=de.applyPatch=de.arrayDiff=void 0;var sf=nf(Pi());de.applyPatch=sf.default;var Pn=Ci();Object.defineProperty(de,"createPatch",{enumerable:!0,get:function(){return Pn.createPatch}});Object.defineProperty(de,"arrayDiff",{enumerable:!0,get:function(){return Pn.arrayDiff}});de.default=Pn.createPatch});var Qi=b(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.requestFullData=be.parseArrayBuffer=be.readUint8=be.decodeHeader=void 0;var of=Et(),af=e=>{let t=e>>4,r=e&15,n=r>>1,s=r&1;return{type:n,isDeflate:s===1,len:t}};be.decodeHeader=af;var uf=(e,t,r)=>{let n=0,s=r-1+t;for(let i=s;i>=t;i--)n=n*256+e[i];return n};be.readUint8=uf;var ff=async e=>{if(e instanceof ArrayBuffer)return new Uint8Array(e);if(typeof window>"u"){if(e instanceof Buffer)return new Uint8Array(e)}else if(e instanceof Blob){let t=await e.arrayBuffer();return new Uint8Array(t)}throw new Error("Recieved incorrect data")};be.parseArrayBuffer=ff;var lf=(e,t)=>{let r=e.observeState.get(t);if(!r){console.warn("Cannot find query function name for id from diff [id]");return}(0,of.addGetToQueue)(e,r.name,t,r.payload)};be.requestFullData=lf});var Bi=b(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.getTargetInfo=void 0;var cf=(e,t,r)=>{let n=r==="sub"?e.observeState.get(t):e.channelState.get(t);return n?n.payload?{name:n.name,payload:n.payload,id:t}:{name:n.name,id:t}:{name:`[Cannot find ${t}]`,id:t}};gr.getTargetInfo=cf});var xi=b(me=>{"use strict";var hf=me&&me.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),df=me&&me.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),gf=me&&me.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&hf(t,e,r);return df(t,e),t};Object.defineProperty(me,"__esModule",{value:!0});me.incoming=void 0;var lt=gf(lr()),vf=Mn(),vr=Zt(),pf=ve(),Tn=wn(),Ei=Qt(),W=Qi(),yf=On(),Ui=Bi(),bf=async(e,t)=>{if(e.isDestroyed)return;let r=e.listeners.debug;try{let n=t.data,s=await(0,W.parseArrayBuffer)(n),{type:i,len:o,isDeflate:a}=(0,W.decodeHeader)((0,W.readUint8)(s,0,4));if(i===0){let f=(0,W.readUint8)(s,4,3),u=7,l=o+4,c;o!==3&&(c=JSON.parse(new TextDecoder().decode(a?lt.inflateSync(s.slice(u,l)):s.slice(u,l)))),e.functionResponseListeners.has(f)&&(e.functionResponseListeners.get(f)[0](c),e.functionResponseListeners.delete(f))}else if(i===3){let f=(0,W.readUint8)(s,4,8);if(e.getState.has(f)&&e.cache.has(f)){let u=e.getState.get(f);for(let[l]of u)l(e.cache.get(f).value);e.getState.delete(f)}}else if(i===2){let f=(0,W.readUint8)(s,4,8),u=e.cache.get(f);if(!u){(0,W.requestFullData)(e,f);return}let l=(0,W.readUint8)(s,12,8),c=(0,W.readUint8)(s,20,8);if(u.checksum!==c){(0,W.requestFullData)(e,f);return}let d=28,h=o+4,g;o!==24&&(g=JSON.parse(new TextDecoder().decode(a?lt.inflateSync(s.slice(d,h)):s.slice(d,h))));try{u.value=(0,vf.applyPatch)(u.value,g),u.checksum=l}catch{(0,W.requestFullData)(e,f);return}if(e.observeState.has(f)){let v=e.observeState.get(f);v.persistent&&(u.persistent=!0,(0,Ei.setStorage)(e,"@based-cache-"+f,u));for(let[,p]of v.subscribers)p.onData(u.value,l)}if(e.getState.has(f)){let v=e.getState.get(f);for(let[p]of v)p(u.value);e.getState.delete(f)}}else if(i===1){let f=(0,W.readUint8)(s,4,8),u=(0,W.readUint8)(s,12,8),l=20,c=o+4,d;o!==16&&(d=JSON.parse(new TextDecoder().decode(a?lt.inflateSync(s.slice(l,c)):s.slice(l,c))));let h={value:d,checksum:u};e.cache.set(f,h);let g=!1;if(e.observeState.has(f)){let v=e.observeState.get(f);v.persistent&&(h.persistent=!0,(0,Ei.setStorage)(e,"@based-cache-"+f,h));for(let[,p]of v.subscribers)p.onData(d,u);g=!0}if(e.getState.has(f)){let v=e.getState.get(f);for(let[p]of v)p(d);e.getState.delete(f),g=!0}}else if(i===4){let u=o+4,l;o!==3&&(l=JSON.parse(new TextDecoder().decode(a?lt.inflateSync(s.slice(4,u)):s.slice(4,u)))),l===!0?e.authRequest.resolve?.(e.authState):"error"in l?((0,Tn.updateAuthState)(e,l),e.emit("authstate-change",e.authState),e.authRequest.reject?.(new Error(l.error))):((0,pf.deepEqual)(e.authState,l)?(0,Tn.updateAuthState)(e,l):((0,Tn.updateAuthState)(e,l),e.emit("authstate-change",e.authState)),e.authRequest?.resolve?.(e.authState))}else if(i===5){let u=o+4,l;if(o!==3&&(l=JSON.parse(new TextDecoder().decode(a?lt.inflateSync(s.slice(4,u)):s.slice(4,u)))),l.requestId&&e.functionResponseListeners.has(l.requestId)){let[,c,d]=e.functionResponseListeners.get(l.requestId);c((0,vr.convertDataToBasedError)(l,d)),e.functionResponseListeners.delete(l.requestId)}if(l.channelId&&e.channelState.has(l.channelId)){let c=(0,vr.convertDataToBasedError)(l),d=e.channelState.get(l.channelId);for(let[,h]of d.subscribers)h.onError?h.onError(c):console.error((0,Ui.getTargetInfo)(e,l.channelId,"channel"),c)}if(l.observableId){if(e.cache.delete(l.observableId),e.observeState.has(l.observableId)){let c=(0,vr.convertDataToBasedError)(l),d=e.observeState.get(l.observableId);for(let[,h]of d.subscribers)h.onError?h.onError(c):console.error((0,Ui.getTargetInfo)(e,l.observableId,"sub"),c)}if(e.getState.has(l.observableId)){let c=(0,vr.convertDataToBasedError)(l),d=e.getState.get(l.observableId);for(let[,h]of d)h(c);e.getState.delete(l.observableId)}}}else if(i===6){let f=(0,W.readUint8)(s,4,8),u=e.channelState.get(f);if(f){if(!u.inTransit){u.inTransit=!0;let{buffers:l,len:c}=(0,yf.encodeSubscribeChannelMessage)(f,[6,u.name,u.payload]),d=new Uint8Array(c),h=0;for(let g of l)d.set(g,h),h+=g.length;e.connection.ws.send(d),u.removeTimer!==-1&&u.removeTimer<2&&(u.removeTimer+=1),setTimeout(()=>{let g=e.channelState.get(f);g&&(g.inTransit=!1)},5e3)}e.connection.ws.send(s)}}else if(i===7&&(0,W.readUint8)(s,4,1)===0){let u=(0,W.readUint8)(s,5,8),l=13,c=o+5,d;if(o!==9){let h=new TextDecoder().decode(a?lt.inflateSync(s.slice(l,c)):s.slice(l,c));try{d=JSON.parse(h)}catch{d=h}}if(e.channelState.has(u)){let h=e.channelState.get(u);for(let[,g]of h.subscribers)g.onMessage(d)}}}catch(n){console.error(981,n)}};me.incoming=bf});var An=b(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.genObserveId=void 0;var Fi=Ce(),mf=(e,t)=>t===void 0?(0,Fi.hash)(e):(0,Fi.hashObjectIgnoreKeyOrder)([e,t]);pr.genObserveId=mf});var Ri=b(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.BasedQuery=void 0;var Dn=Et(),Sf=An(),Li=Qt(),qn=class{constructor(t,r,n,s){this.query=n,this.id=(0,Sf.genObserveId)(r,n),this.client=t,this.name=r,this.persistent=s?.persistent||!1}get cache(){return this.client.cache.get(this.id)||null}clearCache(){this.persistent&&(0,Li.removeStorage)(this.client,"@based-cache-"+this.id),this.client.cache.delete(this.id)}subscribe(t,r){let n,s=this.client.cache.get(this.id);if(this.client.observeState.has(this.id)){let i=this.client.observeState.get(this.id);this.persistent&&!i.persistent&&(i.persistent=!0,s&&(0,Li.setStorage)(this.client,"@based-cache-"+this.id,s)),n=++i.idCnt,i.subscribers.set(n,{onError:r,onData:t})}else{n=1;let i=new Map;i.set(n,{onError:r,onData:t}),this.client.observeState.set(this.id,{payload:this.query,name:this.name,subscribers:i,persistent:this.persistent||!1,idCnt:1}),(0,Dn.addObsToQueue)(this.client,this.name,this.id,this.query,s?.checksum||0)}return s&&t(s.value,s.checksum),()=>{let i=this.client.observeState.get(this.id);i?(i.subscribers.delete(n),i.subscribers.size===0&&(this.client.observeState.delete(this.id),(0,Dn.addObsCloseToQueue)(this.client,this.id))):console.warn("Subscription allready removed",this.query,this.name)}}async getWhen(t){return new Promise(r=>{let n=this.subscribe((s,i)=>{t(s,i)&&(r(s),n())})})}async get(){return new Promise((t,r)=>{if(this.client.getState.has(this.id)){this.client.getState.get(this.id).push([t,r]);return}this.client.getState.set(this.id,[]);let n=this.client.cache.get(this.id);if(this.client.observeState.has(this.id)){if(this.client.observeQueue.has(this.id)){let[s]=this.client.observeQueue.get(this.id);if(s===1){this.client.getState.get(this.id).push([t,r]);return}}if(n){t(n.value);return}}this.client.getState.get(this.id).push([t,r]),(0,Dn.addGetToQueue)(this.client,this.name,this.id,this.query,n?.checksum||0)})}};yr.BasedQuery=qn});var $i=b(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.default=async(e,t,r,n)=>{}});var Ni=b(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.cleanUpChannels=void 0;var _f=e=>{e.channelCleanTimeout||(e.channelCleanTimeout=setTimeout(()=>{if(e.channelCleanTimeout=null,e.connected){let t=!1;e.channelState.forEach((r,n)=>{r.removeTimer!==-1&&(r.removeTimer--,r.removeTimer===0?e.channelState.delete(n):t=!0)}),t&&(0,ct.cleanUpChannels)(e)}else(0,ct.cleanUpChannels)(e)},e.channelCleanupCycle))};ct.cleanUpChannels=_f});var Ji=b(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.BasedChannel=void 0;var wf=An(),br=Et(),Gi=Ni(),In=class{constructor(t,r,n){this.payload=n,this.id=(0,wf.genObserveId)(r,n),this.client=t,this.name=r}subscribe(t,r){let n;if(!this.client.channelState.has(this.id)||this.client.channelState.get(this.id).subscribers.size===0){n=1;let s=new Map;s.set(n,{onMessage:t,onError:r}),this.client.channelState.set(this.id,{payload:this.payload,name:this.name,subscribers:s,removeTimer:-1,idCnt:1}),(0,br.addChannelSubscribeToQueue)(this.client,this.name,this.id,this.payload)}else{let s=this.client.channelState.get(this.id);s.removeTimer=-1,n=++s.idCnt,s.subscribers.set(n,{onMessage:t,onError:r})}return()=>{let s=this.client.channelState.get(this.id);s.subscribers.delete(n),s.subscribers.size===0&&(s.removeTimer=2,(0,br.addChannelCloseToQueue)(this.client,this.id))}}publish(t){if(!this.client.channelState.has(this.id))this.client.channelState.set(this.id,{payload:this.payload,name:this.name,subscribers:new Map,removeTimer:2,idCnt:0}),(0,Gi.cleanUpChannels)(this.client),(0,br.addChannelPublishIdentifier)(this.client,this.name,this.id,this.payload);else{let r=this.client.channelState.get(this.id);r.removeTimer!==-1&&r.removeTimer<2&&(r.removeTimer=2,(0,Gi.cleanUpChannels)(this.client))}(0,br.addToPublishQueue)(this.client,this.id,t)}};mr.BasedChannel=In});var Vr=b(ee=>{"use strict";var Of=ee&&ee.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ki=ee&&ee.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Of(t,e,r)},wr=ee&&ee.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ee,"__esModule",{value:!0});ee.BasedClient=ee.BasedQuery=void 0;var jf=wr(qs()),Mf=wr(zs()),Se=Et(),Pf=xi(),Zi=Ri();Object.defineProperty(ee,"BasedQuery",{enumerable:!0,get:function(){return Zi.BasedQuery}});var Tf=wr($i()),Sr=Qt(),Af=Ji(),Df=Ce(),qf=wr(Hr()),zf=ve();Ki(Kr(),ee);Ki(Zt(),ee);var _r=class extends Mf.default{constructor(t,r){super(),this.storageSize=0,this.maxStorageSize=5e6-500,this.storageEnvKey=0,this.connected=!1,this.outgoingStreams=new Map,this.isDrainingStreams=!1,this.maxPublishQueue=1e3,this.publishQueue=[],this.functionQueue=[],this.observeQueue=new Map,this.channelQueue=new Map,this.getObserveQueue=new Map,this.drainInProgress=!1,this.localStorage=!1,this.maxCacheSize=4e6,this.cache=new Map,this.functionResponseListeners=new Map,this.requestId=0,this.channelState=new Map,this.channelCleanupCycle=3e4,this.observeState=new Map,this.getState=new Map,this.authState={},this.authRequest={authState:null,promise:null,resolve:null,reject:null,inProgress:!1},r?.persistentStorage&&(this.storagePath=r.persistentStorage),r?.maxCacheSize&&(console.warn("MaxCacheSize setting not implemented yet..."),this.maxCacheSize=r.maxCacheSize),t&&this.connect(t)}onClose(){this.connected=!1,this.functionResponseListeners.size>this.functionQueue.length&&this.functionResponseListeners.forEach((t,r)=>{this.functionQueue.find(([n])=>n===r)||(t[1](new Error("Server disconnected before function result was processed")),this.functionResponseListeners.delete(r))}),this.emit("disconnect",!0)}onReconnect(){this.connected=!0,this.emit("reconnect",!0)}onOpen(){this.connected=!0,this.emit("connect",!0);for(let[t,r]of this.observeState)if(!this.observeQueue.has(t)){let n=this.cache.get(t);(0,Se.addObsToQueue)(this,r.name,t,r.payload,n?.checksum||0)}for(let[t,r]of this.channelState)this.channelQueue.has(t)||(r.subscribers.size?(0,Se.addChannelSubscribeToQueue)(this,r.name,t,r.payload):(0,Se.addChannelPublishIdentifier)(this,r.name,t,r.payload));(0,Se.drainQueue)(this)}onData(t){(0,Pf.incoming)(this,t)}async connect(t){if(t&&Object.keys(t).length>0){if(this.opts){if((0,zf.deepEqual)(this.opts,t))return;this.disconnect()}this.opts=t,this.url=()=>(0,qf.default)(t),this.storageEnvKey=(0,Df.hashObjectIgnoreKeyOrder)(t),(0,Sr.initStorage)(this)}if(!this.opts){console.error("Configure opts to connect");return}this.url&&!this.connection&&(this.connection=(0,jf.default)(this,this.url))}disconnect(){this.connection&&(this.connection.disconnected=!0,this.connection.destroy(),this.connection.ws&&this.connection.ws.close(),this.connected&&this.onClose(),delete this.connection),clearTimeout(this.drainTimeout),clearTimeout(this.idlePing),this.connected=!1}async destroy(t){t||await(0,Sr.updateStorage)(this),clearTimeout(this.storageBeingWritten),clearTimeout(this.channelCleanTimeout),this.disconnect();for(let r in this)delete this[r];this.isDestroyed=!0}channel(t,r){return new Af.BasedChannel(this,t,r)}query(t,r,n){return new Zi.BasedQuery(this,t,r,n)}call(t,r,n){let s=n?.retryStrategy;return s?new Promise(i=>{let o=0,a=0,f=u=>{let l=s(u,o,a);a++,typeof l=="number"&&!isNaN(l)&&(o=l,l===0?(0,Se.addToFunctionQueue)(this,r,t,i,f):setTimeout(()=>{(0,Se.addToFunctionQueue)(this,r,t,i,f)},l))};return(0,Se.addToFunctionQueue)(this,r,t,i,f)}):new Promise((i,o)=>(0,Se.addToFunctionQueue)(this,r,t,i,o))}stream(t,r,n){return(0,Tf.default)(this,t,r,n)}setAuthState(t){if(typeof t=="object")return(0,Se.sendAuth)(this,t);throw new Error("Invalid auth() arguments")}clearAuthState(){return(0,Se.sendAuth)(this,{})}clearStorage(){return(0,Sr.clearStorage)(this)}saveStorage(){return(0,Sr.updateStorage)(this)}genCacheScript(){return`<script>window.__basedcache__=${JSON.stringify(If(this))}<\/script>`}};ee.BasedClient=_r;var If=e=>{let t={};return e.cache.forEach((r,n)=>{t[n]=r}),t};function Cf(e,t){return new _r(e,t)}ee.default=Cf});var Hi=no(Vr()),Qf=(0,Hi.default)({url:"ws://localhost:8082"}),Bf=()=>{let e=document.body;Qf.query("text").subscribe(t=>{e.innerHTML=t.map(r=>`<div>${r}</div>`).join("!!!----------")})};Bf();})();
